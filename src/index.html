<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMT QR Code Data Verification Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4d90fe;
            --primary-dark: #357ae8;
            --success: #4caf50;
            --danger: #f44336;
            --warning: #ff9800;
            --info: #2196f3;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }
        
        .container {
            background-color: white;
            width: 100%;
            height: 100vh;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .time-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .current-time {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .week-info-header {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .header-center {
            flex: 1;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: #fff;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .language-selector, .account-selector {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            border: none;
            color: white;
            cursor: pointer;
            min-width: 120px;
        }
        
        .language-selector option, .account-selector option {
            color: #333;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .left-nav {
            width: 220px;
            background-color: #f8f9fa;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .nav-item {
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            color: var(--dark);
        }
        
        .nav-item.active {
            background-color: white;
            border-left: 4px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
        }
        
        .nav-item:hover:not(.active) {
            background-color: #f0f0f0;
        }
        
        .nav-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .nav-item.restricted {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .right-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: white;
        }
        
        .content-panel {
            display: none;
            height: 100%;
            overflow-y: auto;
        }
        
        .content-panel.active {
            display: block;
        }
        
        .module {
            margin-bottom: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e0e0;
        }
        
        .module-title {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 18px;
            display: flex;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }
        
        .module-title i {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        select, input, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        select:focus, input:focus, textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(77, 144, 254, 0.2);
            outline: none;
        }
        
        .fixed-data-container {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .fixed-data-box {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .fixed-data-label {
            font-weight: 500;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .fixed-data-label.original {
            text-align: right;
        }
        
        .fixed-data-label.btk-center {
            text-align: center;
        }
        
        .fixed-data {
            background-color: #f5f9ff;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px dashed var(--primary);
            color: #333;
            font-weight: 500;
            white-space: pre-wrap;
            font-family: monospace;
            min-height: 60px;
            display: flex;
            align-items: center;
            flex: 1;
            justify-content: center;
            text-align: center;
        }
        
        .fixed-data.original {
            background-color: #f0f7ff;
            border-color: var(--info);
            text-align: right;
            justify-content: flex-end;
        }
        
        .btk-rule {
            background-color: #fff8e1;
            border: 1px dashed var(--warning);
        }
        
        .check-btn {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .check-btn:hover {
            background: linear-gradient(to right, var(--primary-dark), #2a65c4);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .check-btn:active {
            transform: translateY(0);
        }
        
        .check-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            opacity: 0;
            transition: all 0.3s;
        }
        
        .result.ok {
            background-color: #e8f5e9;
            color: var(--success);
            border: 1px solid #a5d6a7;
            opacity: 1;
        }
        
        .result.ng {
            background-color: #ffebee;
            color: var(--danger);
            border: 1px solid #ef9a9a;
            opacity: 1;
        }
        
        .highlight {
            color: var(--primary);
            font-weight: bold;
        }
        
        .character-count {
            text-align: right;
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .error-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3f3;
            border-radius: 8px;
            border-left: 4px solid var(--danger);
        }
        
        .marker-info {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--info);
            margin-top: 15px;
        }
        
        .marker-info h4 {
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .marker-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .marker-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .marker {
            font-family: monospace;
            background-color: #e0e0e0;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .form-row input {
            flex: 1;
        }
        
        .add-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .add-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .model-list {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 10px;
            background-color: white;
        }
        
        .model-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .model-item:last-child {
            border-bottom: none;
        }
        
        .delete-btn, .edit-btn {
            color: white;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.2s;
            margin-left: 5px;
        }
        
        .delete-btn {
            background-color: var(--danger);
        }
        
        .delete-btn:hover {
            background-color: #d32f2f;
        }
        
        .edit-btn {
            background-color: var(--info);
        }
        
        .edit-btn:hover {
            background-color: #0b7dda;
        }
        
        .model-board-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .model-board-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .model-board-btn {
            background-color: var(--info);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .model-board-btn:hover {
            background-color: #0b7dda;
        }
        
        .model-board-result {
            margin-top: 15px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            border-left: 4px solid var(--success);
            min-height: 60px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .model-board-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .model-board-item:last-child {
            border-bottom: none;
        }
        
        .model-board-item .model {
            font-weight: bold;
            color: var(--primary);
        }
        
        .model-board-item .board {
            color: var(--dark);
        }
        
        .no-result {
            text-align: center;
            color: var(--gray);
            font-style: italic;
        }
        
        .add-model-board-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f7ff;
            border-radius: 12px;
            border: 1px dashed var(--info);
        }
        
        .table-export-section {
            margin-top: 15px;
            padding: 15px;
            background-color: #e8f5e9;
            border-radius: 8px;
            border: 1px dashed var(--success);
        }
        
        .table-export-section h4 {
            margin-bottom: 10px;
            color: var(--dark);
            display: flex;
            align-items: center;
        }
        
        .table-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .table-btn {
            flex: 1;
            background-color: var(--success);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .table-btn:hover {
            background-color: #388e3c;
        }
        
        .table-btn.template {
            background-color: var(--info);
        }
        
        .table-btn.template:hover {
            background-color: #0b7dda;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .checkbox-container input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }
        
        .checkbox-label {
            font-weight: normal;
            margin-bottom: 0;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .loading-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--success);
        }
        
        .notification.error {
            background-color: var(--danger);
        }
        
        .notification.info {
            background-color: var(--info);
        }
        
        .notification.warning {
            background-color: var(--warning);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 新增：优化机型列表显示 */
        .model-item-content {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .model-item-row {
            display: flex;
            margin-bottom: 4px;
        }
        
        .model-item-label {
            font-weight: 600;
            min-width: 120px;
            color: var(--dark);
        }
        
        .model-item-value {
            flex: 1;
            font-family: monospace;
            color: var(--primary);
        }
        
        .model-item-buttons {
            display: flex;
            gap: 5px;
        }
        
        /* 新增：数据统计卡片 */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card .number {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-card .label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* 新增：批量核对区域 */
        .batch-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed var(--primary);
        }
        
        .batch-input {
            width: 100%;
            min-height: 100px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 10px;
        }
        
        .batch-result {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 10px;
            background-color: white;
        }
        
        .batch-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .batch-item:last-child {
            border-bottom: none;
        }
        
        .batch-item.ok {
            background-color: #e8f5e9;
            color: var(--success);
        }
        
        .batch-item.ng {
            background-color: #ffebee;
            color: var(--danger);
        }
        
        /* 新增：核对记录表格样式 */
        .check-records-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .check-records-table th,
        .check-records-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .check-records-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }
        
        .check-records-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .check-records-table .status-ok {
            color: var(--success);
            font-weight: 600;
        }
        
        .check-records-table .status-ng {
            color: var(--danger);
            font-weight: 600;
        }
        
        .check-records-table .actions {
            display: flex;
            gap: 5px;
        }
        
        .check-records-table .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .check-records-table .action-btn.view {
            color: var(--info);
        }
        
        .check-records-table .action-btn.delete {
            color: var(--danger);
        }
        
        .check-records-table .action-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        /* 新增：日期信息样式 */
        .date-info {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 14px;
            color: var(--gray);
        }
        
        .date-info-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* 移动端优化 */
        @media (max-width: 768px) {
            .container {
                height: auto;
                min-height: 100vh;
            }
            
            .header {
                flex-direction: column;
                gap: 10px;
            }
            
            .header-left, .header-center, .header-right {
                width: 100%;
                text-align: center;
            }
            
            .time-info {
                justify-content: center;
            }
            
            .main-content {
                flex-direction: column;
            }
            
            .left-nav {
                width: 100%;
                flex-direction: row;
                overflow-x: auto;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }
            
            .nav-item {
                flex-shrink: 0;
                border-bottom: none;
                border-right: 1px solid #e0e0e0;
            }
            
            .nav-item.active {
                border-left: none;
                border-bottom: 4px solid var(--primary);
            }
            
            .fixed-data-container {
                flex-direction: column;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .check-records-table {
                display: block;
                overflow-x: auto;
            }
        }
        
        /* 新增：记录详情模态框 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1002;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.2s;
        }
        
        .modal-close:hover {
            color: var(--dark);
        }
        
        .modal-body {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .modal-row {
            display: flex;
            gap: 15px;
        }
        
        .modal-field {
            flex: 1;
        }
        
        .modal-label {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .modal-value {
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        
        .modal-value.result-ok {
            background-color: #e8f5e9;
            border-color: var(--success);
            color: var(--success);
        }
        
        .modal-value.result-ng {
            background-color: #ffebee;
            border-color: var(--danger);
            color: var(--danger);
        }

        /* 新增：分页样式 */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .pagination-info {
            color: var(--gray);
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            gap: 5px;
        }

        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pagination-btn:hover {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pagination-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pagination-btn:disabled {
            background-color: #f8f9fa;
            color: var(--gray);
            cursor: not-allowed;
        }

        /* 性能优化样式 */
        .lazy-load {
            opacity: 0;
            transition: opacity 0.3s;
        }

        .lazy-load.loaded {
            opacity: 1;
        }

        /* 备份管理样式 */
        .backup-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f7ff;
            border-radius: 8px;
            border: 1px dashed var(--info);
        }

        .backup-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .backup-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: white;
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid #e0e0e0;
        }

        .backup-info {
            flex: 1;
        }

        .backup-name {
            font-weight: bold;
            color: var(--dark);
        }

        .backup-meta {
            font-size: 12px;
            color: var(--gray);
            margin-top: 4px;
        }

        .backup-actions {
            display: flex;
            gap: 8px;
        }

        .backup-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .backup-btn.restore {
            background-color: var(--success);
            color: white;
        }

        .backup-btn.export {
            background-color: var(--info);
            color: white;
        }

        .backup-btn.delete {
            background-color: var(--danger);
            color: white;
        }

        .backup-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* 验证错误样式 */
        .validation-error {
            color: var(--danger);
            font-size: 12px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .validation-error i {
            font-size: 14px;
        }

        .input-error {
            border-color: var(--danger) !important;
            box-shadow: 0 0 0 2px rgba(244, 67, 54, 0.2) !important;
        }
        
        /* 用户权限相关样式 */
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-right: 15px;
            color: white;
            font-weight: 500;
        }
        
        .user-role {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .restricted-section {
            position: relative;
        }
        
        .restricted-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            border-radius: 8px;
        }
        
        .restricted-message {
            background-color: var(--warning);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* 密码输入模态框样式 */
        .password-modal {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .password-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin: 15px 0;
        }

        .password-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .password-btn {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .password-btn.confirm {
            background-color: var(--primary);
            color: white;
        }

        .password-btn.cancel {
            background-color: var(--gray);
            color: white;
        }
        
        /* 新增：规格相关样式 */
        .spec-display {
            margin-top: 10px;
            padding: 10px;
            background-color: #f0f7ff;
            border-radius: 6px;
            border-left: 4px solid var(--info);
            font-weight: 500;
            text-align: center;
        }
        
        .spec-display .label {
            font-weight: bold;
            color: var(--dark);
        }
        
        .spec-display .value {
            color: var(--primary);
        }
        
        .spec-right {
            text-align: right;
        }
        
        .spec-center {
            text-align: center;
        }
        
        .spec-left {
            text-align: left;
        }

        /* 机型板号查询结果样式 */
        .model-board-result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .model-board-result-item:last-child {
            border-bottom: none;
        }
        
        .model-board-result-item .model {
            font-weight: bold;
            color: var(--primary);
        }
        
        .model-board-result-item .board {
            color: var(--dark);
            text-align: right;
        }
        
        .model-board-result-item .spec {
            color: var(--info);
            font-weight: 500;
        }
        
        .model-board-result-label {
            font-weight: 600;
            color: var(--dark);
            margin-right: 5px;
        }

        /* 新增：板号靠右显示 */
        .board-right {
            margin-left: auto;
            text-align: right;
        }

        /* 新增：匹配失败详情样式 */
        .failure-details {
            margin-top: 15px;
            padding: 15px;
            background-color: #fff3f3;
            border-radius: 8px;
            border-left: 4px solid var(--danger);
        }

        .failure-details h4 {
            color: var(--danger);
            margin-bottom: 10px;
        }

        .failure-details ul {
            padding-left: 20px;
        }

        .failure-details li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <div class="time-info">
                    <div class="current-time" id="current-time">Loading time...</div>
                    <div class="week-info-header" id="week-info-header">Week XX</div>
                </div>
            </div>
            <div class="header-center">
                <h1 id="app-title">SMT二维码数据核对查询工具</h1>
            </div>
            <div class="header-right">
                <select class="language-selector" id="language-selector">
                    <option value="zh-CN">中文</option>
                    <option value="en">English</option>
                    <option value="vi">Tiếng Việt</option>
                </select>
                <select class="account-selector" id="account-selector">
                    <option value="user">普通账号</option>
                    <option value="admin">管理员</option>
                </select>
            </div>
        </div>
        
        <div class="main-content">
            <div class="left-nav">
                <div class="nav-item active" data-panel="panel1">
                    <i class="fas fa-search"></i> <span data-translate="nav.qr_check">二维码核对</span>
                </div>
                <div class="nav-item" data-panel="panel2">
                    <i class="fas fa-qrcode"></i> <span data-translate="nav.qr_query">二维码查询</span>
                </div>
                <div class="nav-item" data-panel="panel3">
                    <i class="fas fa-microchip"></i> <span data-translate="nav.model_query">机型板号查询</span>
                </div>
                <div class="nav-item restricted" data-panel="panel4">
                    <i class="fas fa-database"></i> <span data-translate="nav.data_management">数据管理</span>
                </div>
                <div class="nav-item restricted" data-panel="panel5">
                    <i class="fas fa-history"></i> <span data-translate="nav.check_records">核对记录</span>
                </div>
            </div>
            
            <div class="right-content">
                <!-- 二维码核对面板 -->
                <div class="content-panel active" id="panel1">
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="number" id="total-models">0</div>
                            <div class="label" data-translate="stats.total_models">总机型数</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="today-checks">0</div>
                            <div class="label" data-translate="stats.today_checks">今日核对次数</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="success-rate">0%</div>
                            <div class="label" data-translate="stats.success_rate">匹配成功率</div>
                        </div>
                    </div>
                    
                    <div class="module">
                        <h2 class="module-title"><i class="fas fa-search"></i> <span data-translate="panel.qr_check">二维码核对</span></h2>
                        
                        <div class="form-group">
                            <label for="model" data-translate="label.select_model">选择机型</label>
                            <select id="model">
                                <option value="" data-translate="option.select_model">请选择机型</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <div class="fixed-data-container">
                                <div class="fixed-data-box">
                                    <div class="fixed-data-label" data-translate="label.fixed_data_conversion">固定数据转换</div>
                                    <div class="fixed-data" id="fixed-data" data-translate="msg.select_model_first">请先选择机型</div>
                                    <div class="character-count" data-translate="label.length">长度: <span id="fixed-data-length">0</span></div>
                                </div>
                                <div class="fixed-data-box">
                                    <div class="fixed-data-label btk-center" data-translate="label.btk_rule">BTK编码规则</div>
                                    <div class="fixed-data btk-rule" id="btk-rule" data-translate="msg.select_model_first">请先选择机型</div>
                                    <div class="character-count" data-translate="label.length">长度: <span id="btk-rule-length">0</span></div>
                                </div>
                                <div class="fixed-data-box">
                                    <div class="fixed-data-label original" data-translate="label.fixed_data">固定数据</div>
                                    <div class="fixed-data original" id="original-fixed-data" data-translate="msg.select_model_first">请先选择机型</div>
                                    <div class="character-count" data-translate="label.length">长度: <span id="original-fixed-data-length">0</span></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="input-data" data-translate="label.input_qr_data">输入二维码数据</label> <span class="highlight" data-translate="label.length">(长度: <span id="input-data-length">0</span>)</span>
                            <input type="text" id="input-data" placeholder="请输入二维码数据" data-translate-placeholder="placeholder.input_qr_data">
                            <div class="character-count" id="input-count">0 <span data-translate="unit.characters">个字符</span></div>
                        </div>
                        
                        <div class="checkbox-container">
                            <input type="checkbox" id="ignore-date-markers">
                            <label class="checkbox-label" for="ignore-date-markers" data-translate="label.ignore_date_markers">忽略日期标记匹配（用于历史日期数据）</label>
                        </div>
                        
                        <button class="check-btn" id="check-btn" data-translate="btn.check_data">核对数据</button>
                        
                        <div class="result" id="result"></div>
                        
                        <!-- 新增：匹配失败详情 -->
                        <div class="failure-details" id="failure-details" style="display: none;">
                            <h4>匹配失败详情</h4>
                            <div id="failure-reasons"></div>
                        </div>
                    </div>
                    
                    <div class="batch-section">
                        <h3><i class="fas fa-list"></i> <span data-translate="label.batch_check">批量核对</span></h3>
                        <textarea class="batch-input" id="batch-input" placeholder="每行输入一个二维码数据，支持批量核对" data-translate-placeholder="placeholder.batch_input"></textarea>
                        <button class="check-btn" id="batch-check-btn" data-translate="btn.batch_check">批量核对</button>
                        <div class="batch-result" id="batch-result">
                            <div class="no-result" data-translate="msg.batch_result_placeholder">批量核对结果将显示在这里</div>
                        </div>
                    </div>
                    
                    <div class="module">
                        <h2 class="module-title"><i class="fas fa-calendar-alt"></i> <span data-translate="panel.dynamic_markers">动态标记说明</span></h2>
                        <div class="marker-info">
                            <h4 data-translate="marker.title">标记说明</h4>
                            <p data-translate="marker.description">固定数据中的标记会被替换为当前日期对应的值，并与输入数据的相同位置进行比较。</p>
                            <div class="marker-list">
                                <div class="marker-item">
                                    <span class="marker">~~~~</span>
                                    <span data-translate="marker.year_4">4位年份 (如: 2024)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">~~</span>
                                    <span data-translate="marker.year_2">2位年份 (如: 24)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">!!</span>
                                    <span data-translate="marker.month_2">2位月份 (如: 01-12)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">!</span>
                                    <span data-translate="marker.month_dynamic">动态月份 (1-9月:数字, 10月:O, 11月:N, 12月:D)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">##</span>
                                    <span data-translate="marker.day_2">2位日期 (如: 01-31)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">$</span>
                                    <span data-translate="marker.weekday">星期几 (1-6, 周一=1, 周六=6, 周日=1)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">^^</span>
                                    <span data-translate="marker.week_2">2位周数 (每年第一天为第1周，下周一为第2周)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">*</span>
                                    <span data-translate="marker.any_char">匹配任意单个字符</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">&</span>
                                    <span data-translate="marker.digit_1_8">匹配1-8的数字</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <p><strong data-translate="example.title">示例:</strong></p>
                            <p data-translate="example.description">如果固定数据是 "AB~~~~!!##"，当前日期是2024年5月1日，则动态数据为 "AB20240501"</p>
                            <p data-translate="example.match">如果输入数据是 "AB20240501"，则匹配成功</p>
                            <p><strong data-translate="example.ignore_title">忽略日期标记匹配:</strong> <span data-translate="example.ignore_description">启用此选项后，将忽略日期相关标记(~~~~,~~,^^,##,$,!!,!)的匹配，只匹配其他固定字符</span></p>
                        </div>
                    </div>
                </div>
                
                <!-- 二维码查询面板 -->
                <div class="content-panel" id="panel2">
                    <div class="module">
                        <h2 class="module-title"><i class="fas fa-qrcode"></i> <span data-translate="panel.qr_query">二维码查询</span></h2>
                        <div class="form-group">
                            <label for="qr-input" data-translate="label.input_qr_data">输入二维码数据</label>
                            <input type="text" id="qr-input" placeholder="请输入二维码数据" data-translate-placeholder="placeholder.input_qr_data">
                            
                            <div class="checkbox-container">
                                <input type="checkbox" id="query-ignore-date-markers">
                                <label class="checkbox-label" for="query-ignore-date-markers" data-translate="label.ignore_date_markers">忽略日期标记匹配（用于历史日期数据）</label>
                            </div>
                            
                            <button class="check-btn" id="query-btn" data-translate="btn.query">查询</button>
                        </div>
                        <div class="form-group">
                            <label data-translate="label.matched_models">匹配的机型</label>
                            <div class="fixed-data" id="query-result" data-translate="msg.no_matched_models">无匹配机型</div>
                        </div>
                    </div>
                    <!-- 新增：动态标记说明 -->
                    <div class="module">
                        <h2 class="module-title"><i class="fas fa-calendar-alt"></i> <span data-translate="panel.dynamic_markers">动态标记说明</span></h2>
                        <div class="marker-info">
                            <h4 data-translate="marker.title">标记说明</h4>
                            <p data-translate="marker.description">固定数据中的标记会被替换为当前日期对应的值，并与输入数据的相同位置进行比较。</p>
                            <div class="marker-list">
                                <div class="marker-item">
                                    <span class="marker">~~~~</span>
                                    <span data-translate="marker.year_4">4位年份 (如: 2024)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">~~</span>
                                    <span data-translate="marker.year_2">2位年份 (如: 24)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">!!</span>
                                    <span data-translate="marker.month_2">2位月份 (如: 01-12)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">!</span>
                                    <span data-translate="marker.month_dynamic">动态月份 (1-9月:数字, 10月:O, 11月:N, 12月:D)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">##</span>
                                    <span data-translate="marker.day_2">2位日期 (如: 01-31)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">$</span>
                                    <span data-translate="marker.weekday">星期几 (1-6, 周一=1, 周六=6, 周日=1)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">^^</span>
                                    <span data-translate="marker.week_2">2位周数 (每年第一天为第1周，下周一为第2周)</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">*</span>
                                    <span data-translate="marker.any_char">匹配任意单个字符</span>
                                </div>
                                <div class="marker-item">
                                    <span class="marker">&</span>
                                    <span data-translate="marker.digit_1_8">匹配1-8的数字</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <p><strong data-translate="example.title">示例:</strong></p>
                            <p data-translate="example.description">如果固定数据是 "AB~~~~!!##"，当前日期是2024年5月1日，则动态数据为 "AB20240501"</p>
                            <p data-translate="example.match">如果输入数据是 "AB20240501"，则匹配成功</p>
                            <p><strong data-translate="example.ignore_title">忽略日期标记匹配:</strong> <span data-translate="example.ignore_description">启用此选项后，将忽略日期相关标记(~~~~,~~,^^,##,$,!!,!)的匹配，只匹配其他固定字符</span></p>
                        </div>
                    </div>
                    
                    <div class="module restricted-section">
                        <div class="restricted-overlay" id="restricted-add-model">
                            <div class="restricted-message" data-translate="msg.need_admin_permission">此功能需要管理员权限</div>
                        </div>
                        <h2 class="module-title"><i class="fas fa-plus"></i> <span data-translate="panel.add_model">添加新机型</span></h2>
                        <div class="new-model-form">
                            <div class="form-group">
                                <label for="new-model" data-translate="label.new_model_id">新机型编号</label>
                                <input type="text" id="new-model" placeholder="输入新机型编号" data-translate-placeholder="placeholder.input_model_id">
                                <div class="validation-error" id="new-model-error"></div>
                            </div>
                            <div class="form-group">
                                <label for="new-btk-rule" class="btk-center" data-translate="label.btk_rule">BTK编码规则</label>
                                <input type="text" id="new-btk-rule" placeholder="输入BTK编码规则" class="btk-center-input" data-translate-placeholder="placeholder.input_btk_rule">
                                <div class="validation-error" id="new-btk-rule-error"></div>
                            </div>
                            <div class="form-group">
                                <label for="new-data" data-translate="label.fixed_data">固定数据</label>
                                <input type="text" id="new-data" placeholder="输入固定数据" data-translate-placeholder="placeholder.input_fixed_data">
                                <div class="validation-error" id="new-data-error"></div>
                            </div>
                        </div>
                        <button class="add-btn" id="add-btn" data-translate="btn.add">添加</button>
                        <div class="model-list" id="model-list">
                            <!-- 动态添加的机型列表 -->
                        </div>
                        <div id="model-pagination" class="pagination-container"></div>
                    </div>
                </div>
                
                <!-- 机型板号查询面板 -->
                <div class="content-panel" id="panel3">
                    <div class="module">
                        <h2 class="module-title"><i class="fas fa-microchip"></i> <span data-translate="panel.model_query">机型板号查询</span></h2>
                        <div class="model-board-input-group">
                            <input type="text" class="model-board-input" id="model-board-input" placeholder="输入机型或板号" data-translate-placeholder="placeholder.input_model_or_board">
                            <button class="model-board-btn" id="model-board-btn" data-translate="btn.query">查询</button>
                        </div>
                        <div class="model-board-result" id="model-board-result">
                            <div class="no-result" data-translate="msg.input_model_or_board">请输入机型或板号进行查询</div>
                        </div>
                        <!-- 新增：规格显示框 -->
                        <div class="spec-display" id="spec-display" style="display: none;">
                            <span class="label" data-translate="label.spec">规格：</span><span class="value" id="spec-value"></span>
                        </div>
                    </div>
                    
                    <div class="module restricted-section">
                        <div class="restricted-overlay" id="restricted-add-model-board">
                            <div class="restricted-message" data-translate="msg.need_admin_permission">此功能需要管理员权限</div>
                        </div>
                        <h2 class="module-title"><i class="fas fa-link"></i> <span data-translate="panel.add_model_board">添加机型与板号</span></h2>
                        <div class="add-model-board-section">
                            <!-- 修改：增加规格输入框 -->
                            <div class="form-row">
                                <input type="text" id="new-model-board" placeholder="输入机型编号" data-translate-placeholder="placeholder.input_model_id" class="spec-left">
                                <input type="text" id="new-board" placeholder="输入对应板号" data-translate-placeholder="placeholder.input_board" class="spec-center">
                                <input type="text" id="new-spec" placeholder="输入规格" data-translate-placeholder="placeholder.input_spec" class="spec-right">
                                <button class="add-btn" id="add-model-board-btn" data-translate="btn.add">添加</button>
                            </div>
                            <div class="model-list" id="model-board-list">
                                <!-- 动态添加的机型板号列表 -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 数据管理面板 -->
                <div class="content-panel restricted-section" id="panel4">
                    <div class="restricted-overlay" id="restricted-data-management">
                        <div class="restricted-message" data-translate="msg.need_admin_permission">此功能需要管理员权限</div>
                    </div>
                    <div class="module">
                        <h2 class="module-title"><i class="fas fa-table"></i> <span data-translate="panel.batch_import">机型数据批量表格导入导出</span></h2>
                        <div class="table-export-section">
                            <h4 data-translate="panel.model_data_batch">机型数据批量操作</h4>
                            <p data-translate="msg.use_excel">使用Excel或CSV文件批量导入导出机型数据</p>
                            <div class="table-buttons">
                                <button class="table-btn" id="export-csv-btn" data-translate="btn.export_csv">导出为CSV</button>
                                <button class="table-btn template" id="download-template-btn" data-translate="btn.download_template">下载模板</button>
                                <input type="file" id="import-table-file" accept=".csv,.xlsx,.xls" style="display: none">
                                <button class="table-btn import" id="import-table-btn" data-translate="btn.import_table">从表格导入</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="module">
                        <h2 class="module-title"><i class="fas fa-list-alt"></i> <span data-translate="panel.model_board_batch">机型与板号批量表格导入导出</span></h2>
                        <div class="table-export-section">
                            <h4 data-translate="panel.model_board_batch">机型与板号批量操作</h4>
                            <p data-translate="msg.use_excel">使用Excel或CSV文件批量导入导出机型与板号映射</p>
                            <div class="table-buttons">
                                <button class="table-btn" id="export-model-board-csv-btn" data-translate="btn.export_csv">导出为CSV</button>
                                <button class="table-btn template" id="download-model-board-template-btn" data-translate="btn.download_template">下载模板</button>
                                <input type="file" id="import-model-board-table-file" accept=".csv,.xlsx,.xls" style="display: none">
                                <button class="table-btn import" id="import-model-board-table-btn" data-translate="btn.import_table">从表格导入</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 新增：核对记录导入导出 -->
                    <div class="module">
                        <h2 class="module-title"><i class="fas fa-history"></i> <span data-translate="panel.check_records_batch">核对记录批量表格导入导出</span></h2>
                        <div class="table-export-section">
                            <h4 data-translate="panel.check_records_batch">核对记录批量操作</h4>
                            <p data-translate="msg.use_excel">使用Excel或CSV文件批量导入导出核对记录</p>
                            <div class="table-buttons">
                                <button class="table-btn" id="export-check-records-csv-btn" data-translate="btn.export_csv">导出为CSV</button>
                                <button class="table-btn template" id="download-check-records-template-btn" data-translate="btn.download_template">下载模板</button>
                                <input type="file" id="import-check-records-table-file" accept=".csv,.xlsx,.xls" style="display: none">
                                <button class="table-btn import" id="import-check-records-table-btn" data-translate="btn.import_table">从表格导入</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 新增：数据备份与恢复 -->
                    <div class="module">
                        <h2 class="module-title"><i class="fas fa-database"></i> <span data-translate="panel.data_backup">数据备份与恢复</span></h2>
                        
                        <div class="backup-section">
                            <h4 data-translate="backup.management">备份管理</h4>
                            <p data-translate="backup.description">创建数据备份以防止数据丢失，支持导入导出备份文件。</p>
                            
                            <div class="form-row">
                                <input type="text" id="backup-name" placeholder="输入备份名称（可选）" data-translate-placeholder="backup.name_placeholder">
                                <button class="add-btn" id="create-backup-btn" data-translate="backup.create_backup">创建备份</button>
                                <input type="file" id="import-backup-file" accept=".json" style="display: none">
                                <button class="add-btn" id="import-backup-btn" data-translate="backup.import_backup">导入备份</button>
                            </div>
                            
                            <div class="backup-list" id="backup-list">
                                <!-- 动态添加的备份列表 -->
                            </div>
                            
                            <div id="backup-pagination" class="pagination-container"></div>
                        </div>
                    </div>
                    
                    <div class="module">
                        <h2 class="module-title"><i class="fas fa-redo"></i> <span data-translate="panel.data_reset">数据重置</span></h2>
                        <div class="form-group">
                            <p data-translate="msg.reset_data">重置数据到默认值</p>
                            <button class="check-btn" id="reset-btn" style="background: linear-gradient(to right, var(--warning), #e68900);" data-translate="btn.reset_data">重置数据</button>
                        </div>
                    </div>
                </div>
                
                <!-- 新增：核对记录面板 -->
                <div class="content-panel restricted-section" id="panel5">
                    <div class="restricted-overlay" id="restricted-check-records">
                        <div class="restricted-message" data-translate="msg.need_admin_permission">此功能需要管理员权限</div>
                    </div>
                    <div class="module">
                        <h2 class="module-title"><i class="fas fa-history"></i> <span data-translate="panel.check_records">核对记录</span></h2>
                        
                        <div class="form-group">
                            <div class="form-row">
                                <input type="text" id="search-check-records" placeholder="搜索机型、二维码数据或结果" data-translate-placeholder="placeholder.search_records">
                                <select id="filter-check-status">
                                    <option value="" data-translate="option.all_status">全部状态</option>
                                    <option value="ok" data-translate="option.status_ok">匹配成功</option>
                                    <option value="ng" data-translate="option.status_ng">匹配失败</option>
                                </select>
                                <input type="date" id="filter-check-date">
                                <button class="add-btn" id="clear-filters-btn" data-translate="btn.clear_filters">清除筛选</button>
                            </div>
                        </div>
                        
                        <div class="check-records-container">
                            <table class="check-records-table">
                                <thead>
                                    <tr>
                                        <th data-translate="table.model">机型</th>
                                        <th data-translate="table.qr_data">二维码数据</th>
                                        <th data-translate="table.result">结果</th>
                                        <th data-translate="table.check_time">核对时间</th>
                                        <th data-translate="table.actions">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="check-records-body">
                                    <!-- 动态添加的核对记录 -->
                                </tbody>
                            </table>
                            <div class="no-result" id="no-records-message" data-translate="msg.no_records">暂无核对记录</div>
                        </div>
                        
                        <div id="record-pagination" class="pagination-container"></div>
                        
                        <div class="table-buttons" style="margin-top: 15px;">
                            <button class="table-btn" id="clear-records-btn" style="background: linear-gradient(to right, var(--danger), #d32f2f);" data-translate="btn.clear_records">清空记录</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载遮罩层 -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- 通知消息 -->
    <div class="notification" id="notification"></div>

    <!-- 新增：记录详情模态框 -->
    <div class="modal-overlay" id="record-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" data-translate="modal.record_details">记录详情</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- 动态添加的详情内容 -->
            </div>
        </div>
    </div>

    <!-- 密码输入模态框 -->
    <div class="modal-overlay" id="password-modal">
        <div class="password-modal">
            <h3>管理员密码验证</h3>
            <p>请输入管理员密码以切换到管理员账号</p>
            <input type="password" class="password-input" id="password-input" placeholder="请输入密码">
            <div class="password-buttons">
                <button class="password-btn confirm" id="password-confirm">确认</button>
                <button class="password-btn cancel" id="password-cancel">取消</button>
            </div>
        </div>
    </div>

    <script>
        // 多语言支持
        const translations = {
            'zh-CN': {
                // 应用标题
                'app_title': 'SMT二维码数据核对查询工具',
                
                // 导航菜单
                'nav.qr_check': '二维码核对',
                'nav.qr_query': '二维码查询',
                'nav.model_query': '机型板号查询',
                'nav.data_management': '数据管理',
                'nav.check_records': '核对记录',
                
                // 统计卡片
                'stats.total_models': '总机型数',
                'stats.today_checks': '今日核对次数',
                'stats.success_rate': '匹配成功率',
                
                // 面板标题
                'panel.qr_check': '二维码核对',
                'panel.dynamic_markers': '动态标记说明',
                'panel.qr_query': '二维码查询',
                'panel.add_model': '添加新机型',
                'panel.model_query': '机型板号查询',
                'panel.add_model_board': '添加机型与板号',
                'panel.batch_import': '机型数据批量表格导入导出',
                'panel.model_data_batch': '机型数据批量操作',
                'panel.model_board_batch': '机型与板号批量表格导入导出',
                'panel.check_records_batch': '核对记录批量表格导入导出',
                'panel.data_reset': '数据重置',
                'panel.check_records': '核对记录',
                'panel.data_backup': '数据备份与恢复',
                
                // 标签
                'label.select_model': '选择机型',
                'label.fixed_data_conversion': '固定数据转换',
                'label.btk_rule': 'BTK编码规则',
                'label.fixed_data': '固定数据',
                'label.input_qr_data': '输入二维码数据',
                'label.length': '长度',
                'label.ignore_date_markers': '忽略日期标记匹配（用于历史日期数据）',
                'label.matched_models': '匹配的机型',
                'label.new_model_id': '新机型编号',
                'label.batch_check': '批量核对',
                'label.spec': '规格',
                
                // 按钮
                'btn.check_data': '核对数据',
                'btn.query': '查询',
                'btn.add': '添加',
                'btn.batch_check': '批量核对',
                'btn.export_csv': '导出为CSV',
                'btn.download_template': '下载模板',
                'btn.import_table': '从表格导入',
                'btn.reset_data': '重置数据',
                'btn.edit': '编辑',
                'btn.delete': '删除',
                'btn.clear_filters': '清除筛选',
                'btn.clear_records': '清空记录',
                'btn.view_details': '查看详情',
                
                // 选项
                'option.select_model': '请选择机型',
                'option.all_status': '全部状态',
                'option.status_ok': '匹配成功',
                'option.status_ng': '匹配失败',
                
                // 消息
                'msg.select_model_first': '请先选择机型',
                'msg.no_matched_models': '无匹配机型',
                'msg.input_model_or_board': '请输入机型或板号进行查询',
                'msg.batch_result_placeholder': '批量核对结果将显示在这里',
                'msg.use_excel': '使用Excel或CSV文件批量导入导出机型数据',
                'msg.reset_data': '重置数据到默认值',
                'msg.confirm_delete': '确定要删除吗？',
                'msg.no_records': '暂无核对记录',
                'msg.confirm_clear_records': '确定要清空所有核对记录吗？',
                'msg.record_deleted': '记录已删除',
                'msg.records_cleared': '所有记录已清空',
                'msg.import_complete': '导入完成',
                'msg.success_imported': '成功导入',
                'msg.records': '条记录',
                'msg.skipped': '跳过',
                'msg.existing_records': '条已存在的记录',
                'msg.operation_failed': '操作失败，请重试',
                'msg.export_success': '导出成功',
                'msg.confirm_reset': '确定要重置数据吗？',
                'msg.language_changed': '语言已切换为',
                'msg.scan_function': '扫描功能需要摄像头权限，请在移动端使用具有摄像头权限的浏览器访问',
                'msg.scan_completed': '模拟扫描完成',
                'msg.input_cleared': '输入已清空',
                'msg.batch_check_completed': '批量核对完成',
                'msg.data_records': '条数据',
                'msg.no_model_selected': '未选择机型',
                'msg.length_mismatch': '长度不符',
                'msg.expected_length': '期望长度',
                'msg.actual_length': '实际长度',
                'msg.match_success': '匹配成功',
                'msg.match_failed': '匹配失败',
                'msg.input_qr_data': '请输入二维码数据',
                'msg.input_model_id': '请输入机型编号',
                'msg.input_fixed_data': '请输入固定数据',
                'msg.input_board': '请输入对应的板号',
                'msg.input_spec': '请输入规格',
                'msg.input_batch_data': '请输入批量数据',
                'msg.no_valid_data': '没有有效的输入数据',
                'msg.no_matched_result': '无匹配结果',
                'msg.backup_success': '数据备份成功',
                'msg.backup_failed': '数据备份失败',
                'msg.backup_not_found': '未找到指定的备份',
                'msg.invalid_backup_format': '备份文件格式无效',
                'msg.restore_success': '数据恢复成功',
                'msg.restore_failed': '数据恢复失败',
                'msg.backup_deleted': '备份已删除',
                'msg.backup_delete_failed': '备份删除失败',
                'msg.import_success': '导入成功',
                'msg.import_failed': '导入失败',
                'msg.file_read_error': '文件读取错误',
                'msg.invalid_backup_file': '无效的备份文件',
                'msg.edit_success': '修改成功',
                'msg.add_success': '添加成功',
                'msg.no_models': '暂无机型数据',
                'msg.none': '无',
                'msg.need_admin_permission': '此功能需要管理员权限',
                
                // 单位
                'unit.characters': '个字符',
                
                // 占位符
                'placeholder.input_qr_data': '请输入二维码数据',
                'placeholder.batch_input': '每行输入一个二维码数据，支持批量核对',
                'placeholder.input_model_id': '输入新机型编号',
                'placeholder.input_btk_rule': '输入BTK编码规则',
                'placeholder.input_fixed_data': '输入固定数据',
                'placeholder.input_model_or_board': '输入机型或板号',
                'placeholder.input_board': '输入对应板号',
                'placeholder.input_spec': '输入规格',
                'placeholder.search_records': '搜索机型、二维码数据或结果',
                
                // 标记说明
                'marker.title': '标记说明',
                'marker.description': '固定数据中的标记会被替换为当前日期对应的值，并与输入数据的相同位置进行比较。',
                'marker.year_4': '4位年份 (如: 2024)',
                'marker.year_2': '2位年份 (如: 24)',
                'marker.month_2': '2位月份 (如: 01-12)',
                'marker.month_dynamic': '动态月份 (1-9月:数字, 10月:O, 11月:N, 12月:D)',
                'marker.day_2': '2位日期 (如: 01-31)',
                'marker.weekday': '星期几 (1-6, 周一=1, 周六=6, 周日=1)',
                'marker.week_2': '2位周数 (每年第一天为第1周，下周一为第2周)',
                'marker.any_char': '匹配任意单个字符',
                'marker.digit_1_8': '匹配1-8的数字',
                
                // 示例
                'example.title': '示例:',
                'example.description': '如果固定数据是 "AB~~~~!!##"，当前日期是2024年5月1日，则动态数据为 "AB20240501"',
                'example.match': '如果输入数据是 "AB20240501"，则匹配成功',
                'example.ignore_title': '忽略日期标记匹配:',
                'example.ignore_description': '启用此选项后，将忽略日期相关标记(~~~~,~~,^^,##,$,!!,!)的匹配，只匹配其他固定字符',
                
                // 表格
                'table.model': '机型',
                'table.qr_data': '二维码数据',
                'table.result': '结果',
                'table.check_time': '核对时间',
                'table.actions': '操作',
                'table.created_date': '创建日期',
                'table.modified_date': '修改日期',
                'table.board': '板号',
                'table.spec': '规格',
                'table.status': '状态',
                'table.input_data': '输入数据',
                'table.expected_data': '期望数据',
                'table.ignore_date_markers': '忽略日期标记',
                
                // 模态框
                'modal.record_details': '记录详情',
                'modal.model': '机型',
                'modal.input_data': '输入数据',
                'modal.expected_data': '期望数据',
                'modal.result': '结果',
                'modal.check_time': '核对时间',
                'modal.ignore_date_markers': '忽略日期标记',
                'modal.created_date': '创建日期',
                'modal.modified_date': '修改日期',
                
                // 验证
                'validation.model_required': '机型编号不能为空',
                'validation.model_too_long': '机型编号不能超过50个字符',
                'validation.model_invalid_chars': '机型编号只能包含字母、数字、下划线和连字符',
                'validation.btk_too_long': 'BTK编码规则不能超过100个字符',
                'validation.fixed_data_required': '固定数据不能为空',
                'validation.fixed_data_too_long': '固定数据不能超过200个字符',
                'validation.invalid_markers': '固定数据包含无效的标记或字符',
                'validation.conflicting_markers': '固定数据包含冲突的标记组合',
                'validation.model_exists': '机型已存在',
                'validation.board_required': '板号不能为空',
                'validation.board_too_long': '板号不能超过50个字符',
                'validation.spec_too_long': '规格不能超过100个字符',
                
                // 分页
                'pagination.showing': '显示',
                'pagination.of': '到',
                'pagination.items': '条',
                'pagination.previous': '上一页',
                'pagination.next': '下一页',
                
                // 备份
                'backup.management': '备份管理',
                'backup.description': '创建数据备份以防止数据丢失，支持导入导出备份文件。',
                'backup.name_placeholder': '输入备份名称（可选）',
                'backup.create_backup': '创建备份',
                'backup.import_backup': '导入备份',
                'backup.restore': '恢复',
                'backup.export': '导出',
                'backup.delete': '删除',
                'backup.size': '大小',
                'backup.date': '日期'
            },
            'en': {
                'app_title': 'SMT QR Code Data Verification Tool',
                'nav.qr_check': 'QR Code Check',
                'nav.qr_query': 'QR Code Query',
                'nav.model_query': 'Model & Board Query',
                'nav.data_management': 'Data Management',
                'nav.check_records': 'Check Records',
                'stats.total_models': 'Total Models',
                'stats.today_checks': 'Today Checks',
                'stats.success_rate': 'Success Rate',
                'panel.qr_check': 'QR Code Check',
                'panel.dynamic_markers': 'Dynamic Markers',
                'panel.qr_query': 'QR Code Query',
                'panel.add_model': 'Add New Model',
                'panel.model_query': 'Model & Board Query',
                'panel.add_model_board': 'Add Model & Board',
                'panel.batch_import': 'Batch Import/Export',
                'panel.model_data_batch': 'Model Data Batch Operation',
                'panel.model_board_batch': 'Model & Board Batch Operation',
                'panel.check_records_batch': 'Check Records Batch Operation',
                'panel.data_reset': 'Data Reset',
                'panel.check_records': 'Check Records',
                'panel.data_backup': 'Data Backup & Restore',
                'label.select_model': 'Select Model',
                'label.fixed_data_conversion': 'Fixed Data Conversion',
                'label.btk_rule': 'BTK Encoding Rule',
                'label.fixed_data': 'Fixed Data',
                'label.input_qr_data': 'Input QR Code Data',
                'label.length': 'Length',
                'label.ignore_date_markers': 'Ignore Date Markers (for historical data)',
                'label.matched_models': 'Matched Models',
                'label.new_model_id': 'New Model ID',
                'label.batch_check': 'Batch Check',
                'label.spec': 'Specification',
                'btn.check_data': 'Check Data',
                'btn.query': 'Query',
                'btn.add': 'Add',
                'btn.batch_check': 'Batch Check',
                'btn.export_csv': 'Export to CSV',
                'btn.download_template': 'Download Template',
                'btn.import_table': 'Import from Table',
                'btn.reset_data': 'Reset Data',
                'btn.edit': 'Edit',
                'btn.delete': 'Delete',
                'btn.clear_filters': 'Clear Filters',
                'btn.clear_records': 'Clear Records',
                'btn.view_details': 'View Details',
                'option.select_model': 'Please select a model',
                'option.all_status': 'All Status',
                'option.status_ok': 'Match Success',
                'option.status_ng': 'Match Failed',
                'msg.select_model_first': 'Please select a model first',
                'msg.no_matched_models': 'No matched models',
                'msg.input_model_or_board': 'Please input model or board for query',
                'msg.batch_result_placeholder': 'Batch check results will be displayed here',
                'msg.use_excel': 'Use Excel or CSV files for batch import/export',
                'msg.reset_data': 'Reset data to default values',
                'msg.confirm_delete': 'Are you sure you want to delete?',
                'msg.no_records': 'No check records',
                'msg.confirm_clear_records': 'Are you sure you want to clear all check records?',
                'msg.record_deleted': 'Record deleted',
                'msg.records_cleared': 'All records cleared',
                'msg.import_complete': 'Import completed',
                'msg.success_imported': 'Successfully imported',
                'msg.records': 'records',
                'msg.skipped': 'Skipped',
                'msg.existing_records': 'existing records',
                'msg.operation_failed': 'Operation failed, please try again',
                'msg.export_success': 'Export successful',
                'msg.confirm_reset': 'Are you sure you want to reset data?',
                'msg.language_changed': 'Language changed to',
                'msg.scan_function': 'Scan function requires camera permission, please use a browser with camera permission on mobile devices',
                'msg.scan_completed': 'Simulated scan completed',
                'msg.input_cleared': 'Input cleared',
                'msg.batch_check_completed': 'Batch check completed',
                'msg.data_records': 'data records',
                'msg.no_model_selected': 'No model selected',
                'msg.length_mismatch': 'Length mismatch',
                'msg.expected_length': 'Expected length',
                'msg.actual_length': 'Actual length',
                'msg.match_success': 'Match successful',
                'msg.match_failed': 'Match failed',
                'msg.input_qr_data': 'Please input QR code data',
                'msg.input_model_id': 'Please input model ID',
                'msg.input_fixed_data': 'Please input fixed data',
                'msg.input_board': 'Please input corresponding board',
                'msg.input_spec': 'Please input specification',
                'msg.input_batch_data': 'Please input batch data',
                'msg.no_valid_data': 'No valid input data',
                'msg.no_matched_result': 'No matched result',
                'msg.backup_success': 'Data backup successful',
                'msg.backup_failed': 'Data backup failed',
                'msg.backup_not_found': 'Specified backup not found',
                'msg.invalid_backup_format': 'Invalid backup format',
                'msg.restore_success': 'Data restore successful',
                'msg.restore_failed': 'Data restore failed',
                'msg.backup_deleted': 'Backup deleted',
                'msg.backup_delete_failed': 'Backup deletion failed',
                'msg.import_success': 'Import successful',
                'msg.import_failed': 'Import failed',
                'msg.file_read_error': 'File read error',
                'msg.invalid_backup_file': 'Invalid backup file',
                'msg.edit_success': 'Edit successful',
                'msg.add_success': 'Add successful',
                'msg.no_models': 'No model data',
                'msg.none': 'None',
                'msg.need_admin_permission': 'This function requires administrator permission',
                'unit.characters': 'characters',
                'placeholder.input_qr_data': 'Please input QR code data',
                'placeholder.batch_input': 'Input one QR code data per line for batch check',
                'placeholder.input_model_id': 'Input new model ID',
                'placeholder.input_btk_rule': 'Input BTK encoding rule',
                'placeholder.input_fixed_data': 'Input fixed data',
                'placeholder.input_model_or_board': 'Input model or board',
                'placeholder.input_board': 'Input corresponding board',
                'placeholder.input_spec': 'Input specification',
                'placeholder.search_records': 'Search model, QR data or result',
                'marker.title': 'Marker Description',
                'marker.description': 'Markers in fixed data will be replaced with current date values and compared with input data at the same position.',
                'marker.year_4': '4-digit year (e.g., 2024)',
                'marker.year_2': '2-digit year (e.g., 24)',
                'marker.month_2': '2-digit month (e.g., 01-12)',
                'marker.month_dynamic': 'Dynamic month (1-9: number, 10: O, 11: N, 12: D)',
                'marker.day_2': '2-digit day (e.g., 01-31)',
                'marker.weekday': 'Day of week (1-6, Monday=1, Saturday=6, Sunday=1)',
                'marker.week_2': '2-digit week (first day of year is week 1, next Monday is week 2)',
                'marker.any_char': 'Match any single character',
                'marker.digit_1_8': 'Match digits 1-8',
                'example.title': 'Example:',
                'example.description': 'If fixed data is "AB~~~~!!##" and current date is May 1, 2024, then dynamic data is "AB20240501"',
                'example.match': 'If input data is "AB20240501", then match is successful',
                'example.ignore_title': 'Ignore Date Markers:',
                'example.ignore_description': 'When enabled, date-related markers (~~~~,~~,^^,##,$,!!,!) will be ignored, only other fixed characters will be matched',
                'table.model': 'Model',
                'table.qr_data': 'QR Data',
                'table.result': 'Result',
                'table.check_time': 'Check Time',
                'table.actions': 'Actions',
                'table.created_date': 'Created Date',
                'table.modified_date': 'Modified Date',
                'table.board': 'Board',
                'table.spec': 'Specification',
                'table.status': 'Status',
                'table.input_data': 'Input Data',
                'table.expected_data': 'Expected Data',
                'table.ignore_date_markers': 'Ignore Date Markers',
                'modal.record_details': 'Record Details',
                'modal.model': 'Model',
                'modal.input_data': 'Input Data',
                'modal.expected_data': 'Expected Data',
                'modal.result': 'Result',
                'modal.check_time': 'Check Time',
                'modal.ignore_date_markers': 'Ignore Date Markers',
                'modal.created_date': 'Created Date',
                'modal.modified_date': 'Modified Date',
                'validation.model_required': 'Model ID is required',
                'validation.model_too_long': 'Model ID cannot exceed 50 characters',
                'validation.model_invalid_chars': 'Model ID can only contain letters, numbers, underscores and hyphens',
                'validation.btk_too_long': 'BTK encoding rule cannot exceed 100 characters',
                'validation.fixed_data_required': 'Fixed data is required',
                'validation.fixed_data_too_long': 'Fixed data cannot exceed 200 characters',
                'validation.invalid_markers': 'Fixed data contains invalid markers or characters',
                'validation.conflicting_markers': 'Fixed data contains conflicting marker combinations',
                'validation.model_exists': 'Model already exists',
                'validation.board_required': 'Board is required',
                'validation.board_too_long': 'Board cannot exceed 50 characters',
                'validation.spec_too_long': 'Specification cannot exceed 100 characters',
                'pagination.showing': 'Showing',
                'pagination.of': 'to',
                'pagination.items': 'items',
                'pagination.previous': 'Previous',
                'pagination.next': 'Next',
                'backup.management': 'Backup Management',
                'backup.description': 'Create data backups to prevent data loss, support import/export backup files.',
                'backup.name_placeholder': 'Input backup name (optional)',
                'backup.create_backup': 'Create Backup',
                'backup.import_backup': 'Import Backup',
                'backup.restore': 'Restore',
                'backup.export': 'Export',
                'backup.delete': 'Delete',
                'backup.size': 'Size',
                'backup.date': 'Date'
            },
            'vi': {
                'app_title': 'Công cụ kiểm tra dữ liệu mã QR SMT',
                'nav.qr_check': 'Kiểm tra mã QR',
                'nav.qr_query': 'Truy vấn mã QR',
                'nav.model_query': 'Truy vấn Model & Board',
                'nav.data_management': 'Quản lý dữ liệu',
                'nav.check_records': 'Lịch sử kiểm tra',
                'stats.total_models': 'Tổng số model',
                'stats.today_checks': 'Số lần kiểm tra hôm nay',
                'stats.success_rate': 'Tỷ lệ thành công',
                'panel.qr_check': 'Kiểm tra mã QR',
                'panel.dynamic_markers': 'Giải thích marker động',
                'panel.qr_query': 'Truy vấn mã QR',
                'panel.add_model': 'Thêm model mới',
                'panel.model_query': 'Truy vấn Model & Board',
                'panel.add_model_board': 'Thêm Model & Board',
                'panel.batch_import': 'Nhập/Xuất hàng loạt',
                'panel.model_data_batch': 'Thao tác dữ liệu model hàng loạt',
                'panel.model_board_batch': 'Thao tác Model & Board hàng loạt',
                'panel.check_records_batch': 'Thao tác lịch sử kiểm tra hàng loạt',
                'panel.data_reset': 'Đặt lại dữ liệu',
                'panel.check_records': 'Lịch sử kiểm tra',
                'panel.data_backup': 'Sao lưu & Phục hồi dữ liệu',
                'label.select_model': 'Chọn model',
                'label.fixed_data_conversion': 'Chuyển đổi dữ liệu cố định',
                'label.btk_rule': 'Quy tắc mã hóa BTK',
                'label.fixed_data': 'Dữ liệu cố định',
                'label.input_qr_data': 'Nhập dữ liệu mã QR',
                'label.length': 'Độ dài',
                'label.ignore_date_markers': 'Bỏ qua marker ngày tháng (cho dữ liệu lịch sử)',
                'label.matched_models': 'Model khớp',
                'label.new_model_id': 'ID model mới',
                'label.batch_check': 'Kiểm tra hàng loạt',
                'label.spec': 'Thông số kỹ thuật',
                'btn.check_data': 'Kiểm tra dữ liệu',
                'btn.query': 'Truy vấn',
                'btn.add': 'Thêm',
                'btn.batch_check': 'Kiểm tra hàng loạt',
                'btn.export_csv': 'Xuất ra CSV',
                'btn.download_template': 'Tải mẫu',
                'btn.import_table': 'Nhập từ bảng',
                'btn.reset_data': 'Đặt lại dữ liệu',
                'btn.edit': 'Sửa',
                'btn.delete': 'Xóa',
                'btn.clear_filters': 'Xóa bộ lọc',
                'btn.clear_records': 'Xóa lịch sử',
                'btn.view_details': 'Xem chi tiết',
                'option.select_model': 'Vui lòng chọn model',
                'option.all_status': 'Tất cả trạng thái',
                'option.status_ok': 'Khớp thành công',
                'option.status_ng': 'Khớp thất bại',
                'msg.select_model_first': 'Vui lòng chọn model trước',
                'msg.no_matched_models': 'Không có model khớp',
                'msg.input_model_or_board': 'Vui lòng nhập model hoặc board để truy vấn',
                'msg.batch_result_placeholder': 'Kết quả kiểm tra hàng loạt sẽ hiển thị ở đây',
                'msg.use_excel': 'Sử dụng file Excel hoặc CSV để nhập/xuất hàng loạt',
                'msg.reset_data': 'Đặt lại dữ liệu về giá trị mặc định',
                'msg.confirm_delete': 'Bạn có chắc chắn muốn xóa?',
                'msg.no_records': 'Không có lịch sử kiểm tra',
                'msg.confirm_clear_records': 'Bạn có chắc chắn muốn xóa tất cả lịch sử kiểm tra?',
                'msg.record_deleted': 'Đã xóa bản ghi',
                'msg.records_cleared': 'Đã xóa tất cả bản ghi',
                'msg.import_complete': 'Nhập hoàn tất',
                'msg.success_imported': 'Đã nhập thành công',
                'msg.records': 'bản ghi',
                'msg.skipped': 'Đã bỏ qua',
                'msg.existing_records': 'bản ghi đã tồn tại',
                'msg.operation_failed': 'Thao tác thất bại, vui lòng thử lại',
                'msg.export_success': 'Xuất thành công',
                'msg.confirm_reset': 'Bạn có chắc chắn muốn đặt lại dữ liệu?',
                'msg.language_changed': 'Đã chuyển ngôn ngữ sang',
                'msg.scan_function': 'Chức năng quét yêu cầu quyền camera, vui lòng sử dụng trình duyệt có quyền camera trên thiết bị di động',
                'msg.scan_completed': 'Quét mô phỏng hoàn tất',
                'msg.input_cleared': 'Đã xóa đầu vào',
                'msg.batch_check_completed': 'Kiểm tra hàng loạt hoàn tất',
                'msg.data_records': 'bản ghi dữ liệu',
                'msg.no_model_selected': 'Chưa chọn model',
                'msg.length_mismatch': 'Độ dài không khớp',
                'msg.expected_length': 'Độ dài mong đợi',
                'msg.actual_length': 'Độ dài thực tế',
                'msg.match_success': 'Khớp thành công',
                'msg.match_failed': 'Khớp thất bại',
                'msg.input_qr_data': 'Vui lòng nhập dữ liệu mã QR',
                'msg.input_model_id': 'Vui lòng nhập ID model',
                'msg.input_fixed_data': 'Vui lòng nhập dữ liệu cố định',
                'msg.input_board': 'Vui lòng nhập board tương ứng',
                'msg.input_spec': 'Vui lòng nhập thông số kỹ thuật',
                'msg.input_batch_data': 'Vui lòng nhập dữ liệu hàng loạt',
                'msg.no_valid_data': 'Không có dữ liệu đầu vào hợp lệ',
                'msg.no_matched_result': 'Không có kết quả khớp',
                'msg.backup_success': 'Sao lưu dữ liệu thành công',
                'msg.backup_failed': 'Sao lưu dữ liệu thất bại',
                'msg.backup_not_found': 'Không tìm thấy bản sao lưu được chỉ định',
                'msg.invalid_backup_format': 'Định dạng sao lưu không hợp lệ',
                'msg.restore_success': 'Phục hồi dữ liệu thành công',
                'msg.restore_failed': 'Phục hồi dữ liệu thất bại',
                'msg.backup_deleted': 'Đã xóa bản sao lưu',
                'msg.backup_delete_failed': 'Xóa bản sao lưu thất bại',
                'msg.import_success': 'Nhập thành công',
                'msg.import_failed': 'Nhập thất bại',
                'msg.file_read_error': 'Lỗi đọc file',
                'msg.invalid_backup_file': 'File sao lưu không hợp lệ',
                'msg.edit_success': 'Sửa thành công',
                'msg.add_success': 'Thêm thành công',
                'msg.no_models': 'Không có dữ liệu model',
                'msg.none': 'Không có',
                'msg.need_admin_permission': 'Chức năng này yêu cầu quyền quản trị viên',
                'unit.characters': 'ký tự',
                'placeholder.input_qr_data': 'Vui lòng nhập dữ liệu mã QR',
                'placeholder.batch_input': 'Nhập một dữ liệu mã QR mỗi dòng để kiểm tra hàng loạt',
                'placeholder.input_model_id': 'Nhập ID model mới',
                'placeholder.input_btk_rule': 'Nhập quy tắc mã hóa BTK',
                'placeholder.input_fixed_data': 'Nhập dữ liệu cố định',
                'placeholder.input_model_or_board': 'Nhập model hoặc board',
                'placeholder.input_board': 'Nhập board tương ứng',
                'placeholder.input_spec': 'Nhập thông số kỹ thuật',
                'placeholder.search_records': 'Tìm kiếm model, dữ liệu QR hoặc kết quả',
                'marker.title': 'Giải thích marker',
                'marker.description': 'Các marker trong dữ liệu cố định sẽ được thay thế bằng giá trị ngày hiện tại và so sánh với dữ liệu đầu vào ở cùng vị trí.',
                'marker.year_4': 'Năm 4 chữ số (ví dụ: 2024)',
                'marker.year_2': 'Năm 2 chữ số (ví dụ: 24)',
                'marker.month_2': 'Tháng 2 chữ số (ví dụ: 01-12)',
                'marker.month_dynamic': 'Tháng động (1-9: số, 10: O, 11: N, 12: D)',
                'marker.day_2': 'Ngày 2 chữ số (ví dụ: 01-31)',
                'marker.weekday': 'Thứ trong tuần (1-6, Thứ 2=1, Thứ 7=6, Chủ nhật=1)',
                'marker.week_2': 'Tuần 2 chữ số (ngày đầu năm là tuần 1, thứ 2 tiếp theo là tuần 2)',
                'marker.any_char': 'Khớp bất kỳ ký tự đơn nào',
                'marker.digit_1_8': 'Khớp số từ 1-8',
                'example.title': 'Ví dụ:',
                'example.description': 'Nếu dữ liệu cố định là "AB~~~~!!##" và ngày hiện tại là 1 tháng 5, 2024, thì dữ liệu động là "AB20240501"',
                'example.match': 'Nếu dữ liệu đầu vào là "AB20240501", thì khớp thành công',
                'example.ignore_title': 'Bỏ qua marker ngày tháng:',
                'example.ignore_description': 'Khi bật, các marker liên quan đến ngày tháng (~~~~,~~,^^,##,$,!!,!) sẽ được bỏ qua, chỉ các ký tự cố định khác sẽ được so khớp',
                'table.model': 'Model',
                'table.qr_data': 'Dữ liệu QR',
                'table.result': 'Kết quả',
                'table.check_time': 'Thời gian kiểm tra',
                'table.actions': 'Thao tác',
                'table.created_date': 'Ngày tạo',
                'table.modified_date': 'Ngày sửa',
                'table.board': 'Board',
                'table.spec': 'Thông số kỹ thuật',
                'table.status': 'Trạng thái',
                'table.input_data': 'Dữ liệu đầu vào',
                'table.expected_data': 'Dữ liệu mong đợi',
                'table.ignore_date_markers': 'Bỏ qua marker ngày',
                'modal.record_details': 'Chi tiết bản ghi',
                'modal.model': 'Model',
                'modal.input_data': 'Dữ liệu đầu vào',
                'modal.expected_data': 'Dữ liệu mong đợi',
                'modal.result': 'Kết quả',
                'modal.check_time': 'Thời gian kiểm tra',
                'modal.ignore_date_markers': 'Bỏ qua marker ngày',
                'modal.created_date': 'Ngày tạo',
                'modal.modified_date': 'Ngày sửa',
                'validation.model_required': 'ID model là bắt buộc',
                'validation.model_too_long': 'ID model không thể vượt quá 50 ký tự',
                'validation.model_invalid_chars': 'ID model chỉ có thể chứa chữ cái, số, dấu gạch dưới và dấu gạch ngang',
                'validation.btk_too_long': 'Quy tắc mã hóa BTK không thể vượt quá 100 ký tự',
                'validation.fixed_data_required': 'Dữ liệu cố định là bắt buộc',
                'validation.fixed_data_too_long': 'Dữ liệu cố định không thể vượt quá 200 ký tự',
                'validation.invalid_markers': 'Dữ liệu cố định chứa marker hoặc ký tự không hợp lệ',
                'validation.conflicting_markers': 'Dữ liệu cố định chứa các kết hợp marker xung đột',
                'validation.model_exists': 'Model đã tồn tại',
                'validation.board_required': 'Board là bắt buộc',
                'validation.board_too_long': 'Board không thể vượt quá 50 ký tự',
                'validation.spec_too_long': 'Thông số kỹ thuật không thể vượt quá 100 ký tự',
                'pagination.showing': 'Hiển thị',
                'pagination.of': 'đến',
                'pagination.items': 'mục',
                'pagination.previous': 'Trang trước',
                'pagination.next': 'Trang sau',
                'backup.management': 'Quản lý sao lưu',
                'backup.description': 'Tạo bản sao lưu dữ liệu để ngăn ngừa mất dữ liệu, hỗ trợ nhập/xuất file sao lưu.',
                'backup.name_placeholder': 'Nhập tên sao lưu (tùy chọn)',
                'backup.create_backup': 'Tạo sao lưu',
                'backup.import_backup': 'Nhập sao lưu',
                'backup.restore': 'Khôi phục',
                'backup.export': 'Xuất',
                'backup.delete': 'Xóa',
                'backup.size': 'Kích thước',
                'backup.date': 'Ngày'
            }
        };

        // 用户角色管理
        class UserManager {
            constructor() {
                this.currentUser = 'user'; // 默认普通账号
                this.users = {
                    'user': {
                        username: '普通用户',
                        role: 'user',
                        permissions: ['panel1', 'panel2', 'panel3'] // 只能访问前三个面板
                    },
                    'admin': {
                        username: '管理员',
                        role: 'admin',
                        permissions: ['panel1', 'panel2', 'panel3', 'panel4', 'panel5'] // 可以访问所有面板
                    }
                };
            }
            
            // 切换用户
            switchUser(accountType) {
                this.currentUser = accountType;
                return this.users[accountType];
            }
            
            // 获取当前用户
            getCurrentUser() {
                return this.users[this.currentUser];
            }
            
            // 检查权限
            hasPermission(panelId) {
                const user = this.getCurrentUser();
                return user.permissions.includes(panelId);
            }
        }

        // 数据管理类
        class DataManager {
            constructor() {
                this.modelData = this.loadModelData();
                this.modelBoardMapping = this.loadModelBoardMapping();
                this.btkRules = this.loadBTKRules();
                this.checkRecords = this.loadCheckRecords();
                this.currentLanguage = 'zh-CN';
            }
            
            // 设置当前语言
            setLanguage(lang) {
                this.currentLanguage = lang;
            }
            
            // 获取翻译
            getTranslation(key) {
                return translations[this.currentLanguage]?.[key] || key;
            }
            
            // 数据存储方法
            saveModelData() {
                localStorage.setItem('modelData', JSON.stringify(this.modelData));
            }
            
            loadModelData() {
                const savedData = localStorage.getItem('modelData');
                if (savedData) {
                    try {
                        const parsedData = JSON.parse(savedData);
                        // 兼容旧版本数据格式
                        if (Array.isArray(parsedData)) {
                            const newData = {};
                            parsedData.forEach(item => {
                                newData[item.model] = item.data;
                            });
                            return newData;
                        }
                        return parsedData;
                    } catch (error) {
                        console.error('解析机型数据失败', error);
                    }
                }
                
                // 默认机型数据
                return {
                    '3T01CK231701A': {
                        data: 'CK2317B~~~~!****',
                        createdDate: new Date().toISOString(),
                        modifiedDate: new Date().toISOString()
                    },
                    '3T02CK231701B': {
                        data: 'CK2317B~~!!##****',
                        createdDate: new Date().toISOString(),
                        modifiedDate: new Date().toISOString()
                    },
                    '3T03CK231701C': {
                        data: 'AB~~!!##****EF',
                        createdDate: new Date().toISOString(),
                        modifiedDate: new Date().toISOString()
                    }
                };
            }
            
            saveBTKRules() {
                localStorage.setItem('btkRules', JSON.stringify(this.btkRules));
            }
            
            loadBTKRules() {
                const savedData = localStorage.getItem('btkRules');
                if (savedData) {
                    try {
                        return JSON.parse(savedData);
                    } catch (error) {
                        console.error('解析BTK规则失败', error);
                    }
                }
                
                // 默认BTK编码规则
                return {
                    '3T01CK231701A': 'BTK-001',
                    '3T02CK231701B': 'BTK-002',
                    '3T03CK231701C': 'BTK-003'
                };
            }
            
            saveModelBoardMapping() {
                localStorage.setItem('modelBoardMapping', JSON.stringify(this.modelBoardMapping));
            }
            
            loadModelBoardMapping() {
                const savedData = localStorage.getItem('modelBoardMapping');
                if (savedData) {
                    try {
                        return JSON.parse(savedData);
                    } catch (error) {
                        console.error('解析机型板号映射失败', error);
                    }
                }
                
                // 修改：添加规格字段
                return {
                    '3T01CK231701A': {
                        board: 'CK2317B',
                        spec: '标准规格'
                    },
                    '3T02CK231701B': {
                        board: 'CK2317C',
                        spec: '高配规格'
                    },
                    '3T03CK231701C': {
                        board: 'CK2318A',
                        spec: '低配规格'
                    }
                };
            }
            
            saveCheckRecords() {
                localStorage.setItem('checkRecords', JSON.stringify(this.checkRecords));
            }
            
            loadCheckRecords() {
                const savedData = localStorage.getItem('checkRecords');
                if (savedData) {
                    try {
                        return JSON.parse(savedData);
                    } catch (error) {
                        console.error('解析核对记录失败', error);
                    }
                }
                
                return [];
            }
            
            // 数据验证方法
            validateModelData(model, btkRule, fixedData) {
                const errors = [];
                
                // 机型编号验证
                if (!model || model.trim() === '') {
                    errors.push(this.getTranslation('validation.model_required'));
                } else if (model.length > 50) {
                    errors.push(this.getTranslation('validation.model_too_long'));
                } else if (!/^[a-zA-Z0-9_-]+$/.test(model)) {
                    errors.push(this.getTranslation('validation.model_invalid_chars'));
                }
                
                // BTK规则验证
                if (btkRule && btkRule.length > 100) {
                    errors.push(this.getTranslation('validation.btk_too_long'));
                }
                
                // 固定数据验证
                if (!fixedData || fixedData.trim() === '') {
                    errors.push(this.getTranslation('validation.fixed_data_required'));
                } else if (fixedData.length > 200) {
                    errors.push(this.getTranslation('validation.fixed_data_too_long'));
                } else {
                    // 验证标记格式
                    const validMarkers = ['~~~~', '~~', '!!', '!', '##', '^^', '$', '*', '&'];
                    let tempData = fixedData;
                    
                    // 移除所有有效标记
                    validMarkers.forEach(marker => {
                        tempData = tempData.split(marker).join('');
                    });
                    
                    // 检查是否包含无效字符（只允许字母、数字和有效标记）
                    if (/[^a-zA-Z0-9]/.test(tempData) && tempData.trim() !== '') {
                        errors.push(this.getTranslation('validation.invalid_markers'));
                    }
                    
                    // 检查标记嵌套
                    const markerStack = [];
                    for (let i = 0; i < fixedData.length; i++) {
                        // 检查4字符标记
                        if (i <= fixedData.length - 4) {
                            const fourChar = fixedData.substring(i, i + 4);
                            if (validMarkers.includes(fourChar)) {
                                markerStack.push(fourChar);
                                i += 3;
                                break;
                            }
                        }
                        
                        // 检查2字符标记
                        if (i <= fixedData.length - 2) {
                            const twoChar = fixedData.substring(i, i + 2);
                            if (validMarkers.includes(twoChar)) {
                                markerStack.push(twoChar);
                                i += 1;
                                break;
                            }
                        }
                        
                        // 检查单字符标记
                        const oneChar = fixedData[i];
                        if (validMarkers.includes(oneChar)) {
                            markerStack.push(oneChar);
                        }
                    }
                    
                    // 验证标记组合的合理性
                    if (this.hasConflictingMarkers(markerStack)) {
                        errors.push(this.getTranslation('validation.conflicting_markers'));
                    }
                }
                
                return errors;
            }
            
            // 检查冲突的标记
            hasConflictingMarkers(markers) {
                const conflicts = {
                    '~~~~': ['~~'], // 4位年份和2位年份冲突
                    '!!': ['!'],    // 2位月份和动态月份冲突
                };
                
                for (const [marker, conflictList] of Object.entries(conflicts)) {
                    if (markers.includes(marker)) {
                        for (const conflictMarker of conflictList) {
                            if (markers.includes(conflictMarker)) {
                                return true;
                            }
                        }
                    }
                }
                return false;
            }
            
            // 验证机型板号数据
            validateModelBoardData(model, board, spec) {
                const errors = [];
                
                if (!model || model.trim() === '') {
                    errors.push(this.getTranslation('validation.model_required'));
                }
                
                if (!board || board.trim() === '') {
                    errors.push(this.getTranslation('validation.board_required'));
                } else if (board.length > 50) {
                    errors.push(this.getTranslation('validation.board_too_long'));
                }
                
                if (spec && spec.length > 100) {
                    errors.push(this.getTranslation('validation.spec_too_long'));
                }
                
                return errors;
            }
            
            // 添加或更新机型
            addOrUpdateModel(model, data, btkRule, editingModel = null) {
                // 数据验证
                const validationErrors = this.validateModelData(model, btkRule, data);
                if (validationErrors.length > 0) {
                    return { 
                        success: false, 
                        message: validationErrors.join(', '),
                        errors: validationErrors
                    };
                }
                
                try {
                    const now = new Date().toISOString();
                    
                    if (editingModel) {
                        // 更新现有机型
                        delete this.modelData[editingModel];
                        delete this.btkRules[editingModel];
                    } else if (this.modelData[model]) {
                        return { 
                            success: false, 
                            message: this.getTranslation('validation.model_exists')
                        };
                    }
                    
                    this.modelData[model] = {
                        data: data,
                        createdDate: editingModel ? this.modelData[editingModel]?.createdDate || now : now,
                        modifiedDate: now
                    };
                    
                    this.btkRules[model] = btkRule;
                    this.saveModelData();
                    this.saveBTKRules();
                    
                    return { 
                        success: true, 
                        message: editingModel ? this.getTranslation('msg.edit_success') : this.getTranslation('msg.add_success')
                    };
                } catch (error) {
                    console.error('添加或更新机型失败', error);
                    return { 
                        success: false, 
                        message: this.getTranslation('msg.operation_failed')
                    };
                }
            }
            
            // 删除机型
            deleteModel(model) {
                try {
                    delete this.modelData[model];
                    delete this.btkRules[model];
                    this.saveModelData();
                    this.saveBTKRules();
                    return { success: true, message: this.getTranslation('msg.record_deleted') };
                } catch (error) {
                    console.error('删除机型失败', error);
                    return { success: false, message: this.getTranslation('msg.operation_failed') };
                }
            }
            
            // 添加或更新机型板号映射
            addOrUpdateModelBoard(model, board, spec, editingModelBoard = null) {
                // 数据验证
                const validationErrors = this.validateModelBoardData(model, board, spec);
                if (validationErrors.length > 0) {
                    return { 
                        success: false, 
                        message: validationErrors.join(', '),
                        errors: validationErrors
                    };
                }
                
                try {
                    if (editingModelBoard) {
                        // 更新现有机型板号映射
                        delete this.modelBoardMapping[editingModelBoard];
                    }
                    
                    this.modelBoardMapping[model] = {
                        board: board,
                        spec: spec || ''
                    };
                    this.saveModelBoardMapping();
                    
                    return { 
                        success: true, 
                        message: editingModelBoard ? this.getTranslation('msg.edit_success') : this.getTranslation('msg.add_success')
                    };
                } catch (error) {
                    console.error('添加或更新机型板号失败', error);
                    return { 
                        success: false, 
                        message: this.getTranslation('msg.operation_failed')
                    };
                }
            }
            
            // 删除机型板号映射
            deleteModelBoard(model) {
                try {
                    delete this.modelBoardMapping[model];
                    this.saveModelBoardMapping();
                    return { success: true, message: this.getTranslation('msg.record_deleted') };
                } catch (error) {
                    console.error('删除机型板号失败', error);
                    return { success: false, message: this.getTranslation('msg.operation_failed') };
                }
            }
            
            // 添加核对记录
            addCheckRecord(model, inputData, expectedData, result, ignoreDateMarkers = false, failureReasons = []) {
                try {
                    const record = {
                        id: Date.now().toString(),
                        model: model,
                        inputData: inputData,
                        expectedData: expectedData,
                        result: result,
                        ignoreDateMarkers: ignoreDateMarkers,
                        failureReasons: failureReasons,
                        checkTime: new Date().toISOString()
                    };
                    
                    this.checkRecords.unshift(record);
                    // 限制记录数量，保留最近1000条
                    if (this.checkRecords.length > 1000) {
                        this.checkRecords = this.checkRecords.slice(0, 1000);
                    }
                    
                    this.saveCheckRecords();
                    return { success: true, message: '记录已保存' };
                } catch (error) {
                    console.error('添加核对记录失败', error);
                    return { success: false, message: '记录保存失败' };
                }
            }
            
            // 删除核对记录
            deleteCheckRecord(id) {
                try {
                    this.checkRecords = this.checkRecords.filter(record => record.id !== id);
                    this.saveCheckRecords();
                    return { success: true, message: this.getTranslation('msg.record_deleted') };
                } catch (error) {
                    console.error('删除核对记录失败', error);
                    return { success: false, message: this.getTranslation('msg.operation_failed') };
                }
            }
            
            // 清空核对记录
            clearCheckRecords() {
                try {
                    this.checkRecords = [];
                    this.saveCheckRecords();
                    return { success: true, message: this.getTranslation('msg.records_cleared') };
                } catch (error) {
                    console.error('清空核对记录失败', error);
                    return { success: false, message: this.getTranslation('msg.operation_failed') };
                }
            }
            
            // 获取筛选后的核对记录
            getFilteredCheckRecords(searchTerm = '', statusFilter = '', dateFilter = '') {
                let filteredRecords = [...this.checkRecords];
                
                // 搜索过滤
                if (searchTerm) {
                    const term = searchTerm.toLowerCase();
                    filteredRecords = filteredRecords.filter(record => 
                        record.model.toLowerCase().includes(term) || 
                        record.inputData.toLowerCase().includes(term) ||
                        record.result.toLowerCase().includes(term)
                    );
                }
                
                // 状态过滤
                if (statusFilter) {
                    filteredRecords = filteredRecords.filter(record => 
                        record.result.toLowerCase() === statusFilter.toLowerCase()
                    );
                }
                
                // 日期过滤
                if (dateFilter) {
                    filteredRecords = filteredRecords.filter(record => {
                        const recordDate = new Date(record.checkTime).toISOString().split('T')[0];
                        return recordDate === dateFilter;
                    });
                }
                
                return filteredRecords;
            }
            
            // 备份数据
            backupData(backupName = null) {
                try {
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    const name = backupName || `backup_${timestamp}`;
                    
                    const backup = {
                        name: name,
                        timestamp: new Date().toISOString(),
                        version: '1.0',
                        data: {
                            modelData: this.modelData,
                            modelBoardMapping: this.modelBoardMapping,
                            btkRules: this.btkRules,
                            checkRecords: this.checkRecords
                        }
                    };
                    
                    // 获取现有备份列表
                    const backups = this.getBackupList();
                    backups.unshift({
                        name: name,
                        timestamp: backup.timestamp,
                        size: JSON.stringify(backup).length
                    });
                    
                    // 限制备份数量，保留最近10个
                    if (backups.length > 10) {
                        backups.splice(10);
                    }
                    
                    // 保存备份数据和备份列表
                    localStorage.setItem(`backup_${name}`, JSON.stringify(backup));
                    localStorage.setItem('backupList', JSON.stringify(backups));
                    
                    return { 
                        success: true, 
                        message: this.getTranslation('msg.backup_success'),
                        backupName: name
                    };
                } catch (error) {
                    console.error('备份数据失败', error);
                    return { 
                        success: false, 
                        message: this.getTranslation('msg.backup_failed')
                    };
                }
            }
            
            // 恢复数据
            restoreData(backupName) {
                try {
                    const backupData = localStorage.getItem(`backup_${backupName}`);
                    if (!backupData) {
                        return { 
                            success: false, 
                            message: this.getTranslation('msg.backup_not_found')
                        };
                    }
                    
                    const backup = JSON.parse(backupData);
                    
                    // 验证备份数据格式
                    if (!backup.data || !backup.data.modelData) {
                        return { 
                            success: false, 
                            message: this.getTranslation('msg.invalid_backup_format')
                        };
                    }
                    
                    // 恢复数据
                    this.modelData = backup.data.modelData;
                    this.modelBoardMapping = backup.data.modelBoardMapping || {};
                    this.btkRules = backup.data.btkRules || {};
                    this.checkRecords = backup.data.checkRecords || [];
                    
                    // 保存恢复的数据
                    this.saveAllData();
                    
                    return { 
                        success: true, 
                        message: this.getTranslation('msg.restore_success')
                    };
                } catch (error) {
                    console.error('恢复数据失败', error);
                    return { 
                        success: false, 
                        message: this.getTranslation('msg.restore_failed')
                    };
                }
            }
            
            // 获取备份列表
            getBackupList() {
                try {
                    return JSON.parse(localStorage.getItem('backupList')) || [];
                } catch (error) {
                    console.error('获取备份列表失败', error);
                    return [];
                }
            }
            
            // 删除备份
            deleteBackup(backupName) {
                try {
                    localStorage.removeItem(`backup_${backupName}`);
                    
                    // 更新备份列表
                    const backups = this.getBackupList();
                    const updatedBackups = backups.filter(backup => backup.name !== backupName);
                    localStorage.setItem('backupList', JSON.stringify(updatedBackups));
                    
                    return { 
                        success: true, 
                        message: this.getTranslation('msg.backup_deleted')
                    };
                } catch (error) {
                    console.error('删除备份失败', error);
                    return { 
                        success: false, 
                        message: this.getTranslation('msg.backup_delete_failed')
                    };
                }
            }
            
            // 导出备份文件
            exportBackup(backupName) {
                try {
                    const backupData = localStorage.getItem(`backup_${backupName}`);
                    if (!backupData) {
                        return { 
                            success: false, 
                            message: this.getTranslation('msg.backup_not_found')
                        };
                    }
                    
                    const backup = JSON.parse(backupData);
                    const blob = new Blob([JSON.stringify(backup, null, 2)], { 
                        type: 'application/json' 
                    });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.setAttribute('href', url);
                    link.setAttribute('download', `${backupName}.json`);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    return { 
                        success: true, 
                        message: this.getTranslation('msg.export_success')
                    };
                } catch (error) {
                    console.error('导出备份失败', error);
                    return { 
                        success: false, 
                        message: this.getTranslation('msg.export_failed')
                    };
                }
            }
            
            // 导入备份文件
            importBackup(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        try {
                            const backup = JSON.parse(e.target.result);
                            
                            // 验证备份文件格式
                            if (!backup.data || !backup.data.modelData) {
                                resolve({ 
                                    success: false, 
                                    message: this.getTranslation('msg.invalid_backup_file')
                                });
                                return;
                            }
                            
                            // 使用导入的数据创建新备份
                            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                            const backupName = `imported_${timestamp}`;
                            
                            backup.name = backupName;
                            backup.timestamp = new Date().toISOString();
                            
                            // 保存导入的备份
                            localStorage.setItem(`backup_${backupName}`, JSON.stringify(backup));
                            
                            // 更新备份列表
                            const backups = this.getBackupList();
                            backups.unshift({
                                name: backupName,
                                timestamp: backup.timestamp,
                                size: JSON.stringify(backup).length
                            });
                            
                            if (backups.length > 10) {
                                backups.splice(10);
                            }
                            
                            localStorage.setItem('backupList', JSON.stringify(backups));
                            
                            resolve({ 
                                success: true, 
                                message: this.getTranslation('msg.import_success'),
                                backupName: backupName
                            });
                        } catch (error) {
                            console.error('导入备份失败', error);
                            resolve({ 
                                success: false, 
                                message: this.getTranslation('msg.import_failed')
                            });
                        }
                    };
                    
                    reader.onerror = () => {
                        resolve({ 
                            success: false, 
                            message: this.getTranslation('msg.file_read_error')
                        });
                    };
                    
                    reader.readAsText(file);
                });
            }
            
            // 保存所有数据
            saveAllData() {
                this.saveModelData();
                this.saveModelBoardMapping();
                this.saveBTKRules();
                this.saveCheckRecords();
            }
            
            // 清除所有数据
            clearAllData() {
                try {
                    this.modelData = {};
                    this.modelBoardMapping = {};
                    this.btkRules = {};
                    this.checkRecords = [];
                    
                    this.saveAllData();
                    
                    return { success: true, message: this.getTranslation('msg.reset_data') };
                } catch (error) {
                    console.error('清除数据失败', error);
                    return { success: false, message: this.getTranslation('msg.operation_failed') };
                }
            }
            
            // 获取数据统计
            getDataStats() {
                return {
                    modelCount: Object.keys(this.modelData).length,
                    modelBoardCount: Object.keys(this.modelBoardMapping).length,
                    btkRuleCount: Object.keys(this.btkRules).length,
                    checkRecordsCount: this.checkRecords.length
                };
            }
            
            // 获取统计信息
            getStatistics() {
                const today = new Date().toDateString();
                const stats = JSON.parse(localStorage.getItem('statistics') || '{}');
                
                if (!stats[today]) {
                    stats[today] = {
                        checks: 0,
                        matches: 0
                    };
                }
                
                return {
                    today: stats[today],
                    overall: this.calculateOverallStats(stats)
                };
            }
            
            // 计算总体统计
            calculateOverallStats(stats) {
                let totalChecks = 0;
                let totalMatches = 0;
                
                Object.values(stats).forEach(day => {
                    totalChecks += day.checks;
                    totalMatches += day.matches;
                });
                
                return {
                    checks: totalChecks,
                    matches: totalMatches,
                    successRate: totalChecks > 0 ? Math.round((totalMatches / totalChecks) * 100) : 0
                };
            }
            
            // 记录核对结果
            recordCheck(isMatch) {
                const today = new Date().toDateString();
                const stats = JSON.parse(localStorage.getItem('statistics') || '{}');
                
                if (!stats[today]) {
                    stats[today] = {
                        checks: 0,
                        matches: 0
                    };
                }
                
                stats[today].checks++;
                if (isMatch) {
                    stats[today].matches++;
                }
                
                localStorage.setItem('statistics', JSON.stringify(stats));
            }
        }

        // 日期处理类
        class DateHelper {
            constructor() {
                this.currentDate = new Date();
            }
            
            // 获取当前日期信息
            getCurrentDateInfo() {
                const now = this.currentDate;
                const year = now.getFullYear().toString();
                const yearShort = year.slice(-2);
                
                const month = now.getMonth() + 1;
                const monthDouble = month.toString().padStart(2, '0');
                
                // 动态月份表示方式：1-9月对应数字，10月对应O，11月对应N，12月对应D
                let monthDynamic;
                if (month >= 1 && month <= 9) {
                    monthDynamic = month.toString();
                } else if (month === 10) {
                    monthDynamic = 'O';
                } else if (month === 11) {
                    monthDynamic = 'N';
                } else if (month === 12) {
                    monthDynamic = 'D';
                } else {
                    monthDynamic = month.toString(); // 备用
                }
                
                const day = now.getDate().toString().padStart(2, '0');
                
                // 计算周数 - 每年第一天为第1周，下周一为第2周
                const firstDayOfYear = new Date(now.getFullYear(), 0, 1);
                const firstDayOfYearWeekday = firstDayOfYear.getDay(); // 0=周日, 1=周一, ..., 6=周六
                
                // 计算第一个周一
                let firstMonday;
                if (firstDayOfYearWeekday === 1) {
                    // 1月1日是周一，那么第一个周一是1月1日
                    firstMonday = firstDayOfYear;
                } else {
                    // 计算第一个周一的日期
                    firstMonday = new Date(firstDayOfYear);
                    // 如果1月1日是周日，那么第一个周一是1月2日
                    // 如果1月1日是周二到周六，那么第一个周一是1月1日之后的第一个周一
                    const daysToAdd = firstDayOfYearWeekday === 0 ? 1 : (8 - firstDayOfYearWeekday);
                    firstMonday.setDate(firstDayOfYear.getDate() + daysToAdd);
                }
                
                let weekNumber;
                if (now < firstMonday) {
                    // 当前日期在第一个周一之前，属于第1周
                    weekNumber = 1;
                } else {
                    // 计算从第一个周一开始经过了多少周
                    const diffTime = now - firstMonday;
                    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                    weekNumber = 2 + Math.floor(diffDays / 7);
                }
                
                // 确保周数在1-53之间
                if (weekNumber < 1) {
                    weekNumber = 1;
                } else if (weekNumber > 53) {
                    weekNumber = 53;
                }
                
                const weekDouble = weekNumber.toString().padStart(2, '0');
                
                // 计算星期几 (特殊规则：周一=1, 周二=2, ..., 周六=6, 周日=1)
                let weekday = now.getDay(); // 0 (周日) 到 6 (周六)
                if (weekday === 0) {
                    weekday = 1; // 周日转换为1
                }
                // 周一(1)到周六(6)保持不变
                
                return {
                    '~~~~': year,
                    '~~': yearShort,
                    '!!': monthDouble,
                    '!': monthDynamic,
                    '##': day,
                    '^^': weekDouble,
                    '$': weekday.toString() // 特殊规则：1-6对应周一到周六，周日也对应1
                };
            }
            
            // 获取动态固定数据（替换日期标记）
            getDynamicFixedData(fixedData) {
                const dateInfo = this.getCurrentDateInfo();
                
                // 按标记长度从长到短替换，避免部分替换问题
                let dynamicData = fixedData;
                
                // 替换多字符标记
                dynamicData = dynamicData
                    .replace(/~~~~/g, dateInfo['~~~~'])
                    .replace(/~~/g, dateInfo['~~'])
                    .replace(/!!/g, dateInfo['!!'])
                    .replace(/##/g, dateInfo['##'])
                    .replace(/\^\^/g, dateInfo['^^']);
                
                // 替换单字符标记
                dynamicData = dynamicData
                    .replace(/!/g, dateInfo['!'])
                    .replace(/\$/g, dateInfo['$']);
                
                return dynamicData;
            }
            
            // 创建日期标记掩码
            createDateMarkerMask(fixedData) {
                const dateMarkers = ['~~~~', '~~', '^^', '##', '$', '!!', '!'];
                const mask = new Array(fixedData.length).fill(false);
                
                for (let i = 0; i < fixedData.length; i++) {
                    for (const marker of dateMarkers) {
                        if (marker.length === 4 && i < fixedData.length - 3) {
                            if (fixedData.substring(i, i + 4) === marker) {
                                mask.fill(true, i, i + 4);
                                i += 3;
                                break;
                            }
                        } else if (marker.length === 2 && i < fixedData.length - 1) {
                            if (fixedData.substring(i, i + 2) === marker) {
                                mask.fill(true, i, i + 2);
                                i++;
                                break;
                            }
                        } else if (marker.length === 1) {
                            if (fixedData[i] === marker) {
                                mask[i] = true;
                                break;
                            }
                        }
                    }
                }
                
                return mask;
            }
            
            // 更新当前日期
            updateCurrentDate() {
                this.currentDate = new Date();
            }
            
            // 格式化日期显示
            formatDate(dateString, includeTime = true) {
                const date = new Date(dateString);
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                
                if (!includeTime) {
                    return `${year}-${month}-${day}`;
                }
                
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                const seconds = date.getSeconds().toString().padStart(2, '0');
                
                return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
            }
            
            // 格式化文件大小
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }

        // 主应用类
        class QRDataCheckTool {
            constructor() {
                this.userManager = new UserManager();
                this.dataManager = new DataManager();
                this.dateHelper = new DateHelper();
                this.editingModel = null;
                this.editingModelBoard = null;
                this.currentLanguage = localStorage.getItem('language') || 'zh-CN';
                this.dataManager.setLanguage(this.currentLanguage);
                
                // 分页相关属性
                this.currentModelPage = 1;
                this.modelsPerPage = 10;
                this.currentRecordPage = 1;
                this.recordsPerPage = 20;
                this.currentBackupPage = 1;
                this.backupsPerPage = 10;
                
                // 性能优化
                this.debounceTimers = {};
                
                this.initializeElements();
                this.bindEvents();
                this.updateUI();
                this.updateCurrentTime();
                this.changeLanguage(this.currentLanguage);
                this.setupUserPermissions(); // 设置用户权限
            }
            
            initializeElements() {
                // 导航菜单
                this.navItems = document.querySelectorAll('.nav-item');
                this.contentPanels = document.querySelectorAll('.content-panel');
                
                // 机型选择与核对相关元素
                this.modelSelect = document.getElementById('model');
                this.fixedDataElement = document.getElementById('fixed-data');
                this.btkRuleElement = document.getElementById('btk-rule');
                this.originalFixedDataElement = document.getElementById('original-fixed-data');
                this.fixedDataLengthElement = document.getElementById('fixed-data-length');
                this.btkRuleLengthElement = document.getElementById('btk-rule-length');
                this.originalFixedDataLengthElement = document.getElementById('original-fixed-data-length');
                this.inputData = document.getElementById('input-data');
                this.inputDataLengthElement = document.getElementById('input-data-length');
                this.inputCountElement = document.getElementById('input-count');
                this.checkBtn = document.getElementById('check-btn');
                this.resultElement = document.getElementById('result');
                this.ignoreDateMarkersCheckbox = document.getElementById('ignore-date-markers');
                this.failureDetails = document.getElementById('failure-details');
                this.failureReasons = document.getElementById('failure-reasons');
                
                // 二维码查询相关元素
                this.qrInput = document.getElementById('qr-input');
                this.queryBtn = document.getElementById('query-btn');
                this.queryResult = document.getElementById('query-result');
                this.queryIgnoreDateMarkersCheckbox = document.getElementById('query-ignore-date-markers');
                
                // 添加新机型相关元素
                this.newModelInput = document.getElementById('new-model');
                this.newBtkRuleInput = document.getElementById('new-btk-rule');
                this.newDataInput = document.getElementById('new-data');
                this.addBtn = document.getElementById('add-btn');
                this.modelList = document.getElementById('model-list');
                
                // 机型板号查询相关元素
                this.modelBoardInput = document.getElementById('model-board-input');
                this.modelBoardBtn = document.getElementById('model-board-btn');
                this.modelBoardResult = document.getElementById('model-board-result');
                this.specDisplay = document.getElementById('spec-display');
                this.specValue = document.getElementById('spec-value');
                
                // 添加机型与板号相关元素
                this.newModelBoardInput = document.getElementById('new-model-board');
                this.newBoardInput = document.getElementById('new-board');
                this.newSpecInput = document.getElementById('new-spec');
                this.addModelBoardBtn = document.getElementById('add-model-board-btn');
                this.modelBoardList = document.getElementById('model-board-list');
                
                // 表格导入导出相关元素
                this.exportCsvBtn = document.getElementById('export-csv-btn');
                this.downloadTemplateBtn = document.getElementById('download-template-btn');
                this.importTableBtn = document.getElementById('import-table-btn');
                this.importTableFile = document.getElementById('import-table-file');
                this.exportModelBoardCsvBtn = document.getElementById('export-model-board-csv-btn');
                this.downloadModelBoardTemplateBtn = document.getElementById('download-model-board-template-btn');
                this.importModelBoardTableBtn = document.getElementById('import-model-board-table-btn');
                this.importModelBoardTableFile = document.getElementById('import-model-board-table-file');
                this.resetBtn = document.getElementById('reset-btn');
                
                // 时间相关元素
                this.currentTimeElement = document.getElementById('current-time');
                this.weekInfoHeader = document.getElementById('week-info-header');
                
                // 语言选择器
                this.languageSelector = document.getElementById('language-selector');
                
                // 账号选择器
                this.accountSelector = document.getElementById('account-selector');
                
                // 加载和通知元素
                this.loadingOverlay = document.getElementById('loading-overlay');
                this.notification = document.getElementById('notification');
                
                // 新增元素
                this.batchInput = document.getElementById('batch-input');
                this.batchCheckBtn = document.getElementById('batch-check-btn');
                this.batchResult = document.getElementById('batch-result');
                
                this.totalModelsElement = document.getElementById('total-models');
                this.todayChecksElement = document.getElementById('today-checks');
                this.successRateElement = document.getElementById('success-rate');
                
                // 核对记录相关元素
                this.searchCheckRecords = document.getElementById('search-check-records');
                this.filterCheckStatus = document.getElementById('filter-check-status');
                this.filterCheckDate = document.getElementById('filter-check-date');
                this.clearFiltersBtn = document.getElementById('clear-filters-btn');
                this.checkRecordsBody = document.getElementById('check-records-body');
                this.noRecordsMessage = document.getElementById('no-records-message');
                this.clearRecordsBtn = document.getElementById('clear-records-btn');
                
                // 核对记录导入导出
                this.exportCheckRecordsCsvBtn = document.getElementById('export-check-records-csv-btn');
                this.downloadCheckRecordsTemplateBtn = document.getElementById('download-check-records-template-btn');
                this.importCheckRecordsTableBtn = document.getElementById('import-check-records-table-btn');
                this.importCheckRecordsTableFile = document.getElementById('import-check-records-table-file');
                
                // 备份管理相关元素
                this.backupNameInput = document.getElementById('backup-name');
                this.createBackupBtn = document.getElementById('create-backup-btn');
                this.importBackupBtn = document.getElementById('import-backup-btn');
                this.importBackupFile = document.getElementById('import-backup-file');
                this.backupList = document.getElementById('backup-list');
                
                // 模态框相关元素
                this.recordModal = document.getElementById('record-modal');
                this.modalClose = document.getElementById('modal-close');
                this.modalBody = document.getElementById('modal-body');
                
                // 验证错误元素
                this.newModelError = document.getElementById('new-model-error');
                this.newBtkRuleError = document.getElementById('new-btk-rule-error');
                this.newDataError = document.getElementById('new-data-error');
                
                // 权限受限区域
                this.restrictedAddModel = document.getElementById('restricted-add-model');
                this.restrictedAddModelBoard = document.getElementById('restricted-add-model-board');
                this.restrictedDataManagement = document.getElementById('restricted-data-management');
                this.restrictedCheckRecords = document.getElementById('restricted-check-records');
                
                // 密码输入模态框
                this.passwordModal = document.getElementById('password-modal');
                this.passwordInput = document.getElementById('password-input');
                this.passwordConfirm = document.getElementById('password-confirm');
                this.passwordCancel = document.getElementById('password-cancel');
            }
            
            bindEvents() {
                // 导航菜单事件
                this.navItems.forEach(item => {
                    item.addEventListener('click', () => {
                        const panelId = item.getAttribute('data-panel');
                        if (!item.classList.contains('restricted')) {
                            this.switchPanel(panelId);
                        } else {
                            this.showNotification(this.dataManager.getTranslation('msg.need_admin_permission'), 'warning');
                        }
                    });
                });
                
                // 机型选择与核对事件
                this.modelSelect.addEventListener('change', () => this.handleModelChange());
                this.inputData.addEventListener('input', () => this.handleInputChange());
                this.checkBtn.addEventListener('click', () => this.checkData());
                this.inputData.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.checkBtn.click();
                    }
                });
                
                // 二维码查询事件
                this.queryBtn.addEventListener('click', () => this.queryModel());
                this.qrInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.queryModel();
                    }
                });
                
                // 添加新机型事件
                this.addBtn.addEventListener('click', () => this.addOrUpdateModel());
                
                // 机型板号查询事件
                this.modelBoardBtn.addEventListener('click', () => this.queryModelBoard());
                this.modelBoardInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.queryModelBoard();
                    }
                });
                
                // 添加机型与板号事件
                this.addModelBoardBtn.addEventListener('click', () => this.addOrUpdateModelBoard());
                
                // 表格导入导出事件
                this.exportCsvBtn.addEventListener('click', () => this.exportToCSV());
                this.downloadTemplateBtn.addEventListener('click', () => this.downloadTemplate());
                this.importTableBtn.addEventListener('click', () => this.importTableFile.click());
                this.importTableFile.addEventListener('change', (e) => this.importFromTable(e));
                
                this.exportModelBoardCsvBtn.addEventListener('click', () => this.exportModelBoardToCSV());
                this.downloadModelBoardTemplateBtn.addEventListener('click', () => this.downloadModelBoardTemplate());
                this.importModelBoardTableBtn.addEventListener('click', () => this.importModelBoardTableFile.click());
                this.importModelBoardTableFile.addEventListener('change', (e) => this.importModelBoardFromTable(e));
                
                this.resetBtn.addEventListener('click', () => this.resetData());
                
                // 语言选择事件
                this.languageSelector.addEventListener('change', (e) => this.changeLanguage(e.target.value));
                
                // 账号选择事件
                this.accountSelector.addEventListener('change', (e) => this.handleAccountSwitch(e.target.value));
                
                // 新增事件
                this.batchCheckBtn.addEventListener('click', () => this.batchCheck());
                
                // 核对记录事件
                this.searchCheckRecords.addEventListener('input', () => this.updateCheckRecordsTable());
                this.filterCheckStatus.addEventListener('change', () => this.updateCheckRecordsTable());
                this.filterCheckDate.addEventListener('change', () => this.updateCheckRecordsTable());
                this.clearFiltersBtn.addEventListener('click', () => this.clearFilters());
                this.clearRecordsBtn.addEventListener('click', () => this.clearCheckRecords());
                
                // 核对记录导入导出事件
                this.exportCheckRecordsCsvBtn.addEventListener('click', () => this.exportCheckRecordsToCSV());
                this.downloadCheckRecordsTemplateBtn.addEventListener('click', () => this.downloadCheckRecordsTemplate());
                this.importCheckRecordsTableBtn.addEventListener('click', () => this.importCheckRecordsTableFile.click());
                this.importCheckRecordsTableFile.addEventListener('change', (e) => this.importCheckRecordsFromTable(e));
                
                // 备份管理事件
                this.createBackupBtn.addEventListener('click', () => this.createBackup());
                this.importBackupBtn.addEventListener('click', () => this.importBackupFile.click());
                this.importBackupFile.addEventListener('change', (e) => this.importBackup(e));
                
                // 模态框事件
                this.modalClose.addEventListener('click', () => this.closeModal());
                this.recordModal.addEventListener('click', (e) => {
                    if (e.target === this.recordModal) {
                        this.closeModal();
                    }
                });
                
                // 密码输入模态框事件
                this.passwordConfirm.addEventListener('click', () => this.handlePasswordConfirm());
                this.passwordCancel.addEventListener('click', () => this.handlePasswordCancel());
                this.passwordModal.addEventListener('click', (e) => {
                    if (e.target === this.passwordModal) {
                        this.handlePasswordCancel();
                    }
                });
                
                // 设置防抖搜索
                this.setupDebouncedSearch();
            }
            
            // 处理账号切换
            handleAccountSwitch(accountType) {
                if (accountType === 'admin') {
                    // 显示密码输入模态框
                    this.passwordModal.classList.add('active');
                    this.passwordInput.value = '';
                    this.passwordInput.focus();
                } else {
                    // 直接切换到普通用户
                    this.switchAccount(accountType);
                }
            }
            
            // 处理密码确认
            handlePasswordConfirm() {
                const password = this.passwordInput.value;
                if (password === '300074') {
                    // 密码正确，切换到管理员
                    this.switchAccount('admin');
                    this.passwordModal.classList.remove('active');
                    this.showNotification('已切换到管理员账号', 'success');
                } else {
                    // 密码错误
                    this.showNotification('密码错误，请重试', 'error');
                    this.passwordInput.value = '';
                    this.passwordInput.focus();
                }
            }
            
            // 处理密码取消
            handlePasswordCancel() {
                this.passwordModal.classList.remove('active');
                // 恢复账号选择器为当前用户
                this.accountSelector.value = this.userManager.currentUser;
            }
            
            // 设置用户权限
            setupUserPermissions() {
                const user = this.userManager.getCurrentUser();
                
                // 更新账号选择器
                this.accountSelector.value = user.role;
                
                // 更新导航菜单权限
                this.updateNavPermissions();
                
                // 更新受限区域显示
                this.updateRestrictedAreas();
            }
            
            // 更新导航菜单权限
            updateNavPermissions() {
                const user = this.userManager.getCurrentUser();
                
                this.navItems.forEach(item => {
                    const panelId = item.getAttribute('data-panel');
                    if (user.permissions.includes(panelId)) {
                        item.classList.remove('restricted');
                    } else {
                        item.classList.add('restricted');
                    }
                });
            }
            
            // 更新受限区域显示
            updateRestrictedAreas() {
                const user = this.userManager.getCurrentUser();
                
                // 显示或隐藏受限区域遮罩
                if (user.role === 'admin') {
                    this.restrictedAddModel.style.display = 'none';
                    this.restrictedAddModelBoard.style.display = 'none';
                    this.restrictedDataManagement.style.display = 'none';
                    this.restrictedCheckRecords.style.display = 'none';
                } else {
                    this.restrictedAddModel.style.display = 'flex';
                    this.restrictedAddModelBoard.style.display = 'flex';
                    this.restrictedDataManagement.style.display = 'flex';
                    this.restrictedCheckRecords.style.display = 'flex';
                }
            }
            
            // 切换账号
            switchAccount(accountType) {
                const user = this.userManager.switchUser(accountType);
                
                // 更新账号选择器
                this.accountSelector.value = user.role;
                
                // 更新导航菜单权限
                this.updateNavPermissions();
                
                // 更新受限区域显示
                this.updateRestrictedAreas();
                
                // 如果当前面板不在权限范围内，切换到第一个有权限的面板
                const currentPanel = document.querySelector('.content-panel.active');
                if (currentPanel && !user.permissions.includes(currentPanel.id)) {
                    const firstAllowedPanel = user.permissions[0];
                    this.switchPanel(firstAllowedPanel);
                }
            }
            
            switchPanel(panelId) {
                // 检查权限
                if (!this.userManager.hasPermission(panelId)) {
                    this.showNotification(this.dataManager.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                // 更新导航菜单状态
                this.navItems.forEach(item => {
                    item.classList.remove('active');
                });
                
                const activeNavItem = document.querySelector(`.nav-item[data-panel="${panelId}"]`);
                if (activeNavItem) {
                    activeNavItem.classList.add('active');
                }
                
                // 更新内容面板状态
                this.contentPanels.forEach(panel => {
                    panel.classList.remove('active');
                });
                
                const activePanel = document.getElementById(panelId);
                if (activePanel) {
                    activePanel.classList.add('active');
                    activePanel.classList.add('fade-in');
                    
                    // 如果是核对记录面板，更新表格
                    if (panelId === 'panel5') {
                        this.updateCheckRecordsTable();
                    }
                    // 如果是数据管理面板，更新备份列表
                    else if (panelId === 'panel4') {
                        this.updateBackupList();
                    }
                }
            }
            
            updateUI() {
                this.updateModelSelect();
                this.updateModelList();
                this.updateModelBoardList();
                this.updateCurrentTime();
                this.updateStatistics();
            }
            
            updateCurrentTime() {
                this.dateHelper.updateCurrentDate();
                const dateInfo = this.dateHelper.getCurrentDateInfo();
                
                const now = this.dateHelper.currentDate;
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                
                this.currentTimeElement.textContent = `${year}年${month}月${day}日 ${hours}:${minutes}:${seconds}`;
                this.weekInfoHeader.textContent = `第${dateInfo['^^']}周`;
                
                // 每秒更新一次时间
                setTimeout(() => this.updateCurrentTime(), 1000);
            }
            
            // 更新下拉选择框
            updateModelSelect() {
                const currentValue = this.modelSelect.value;
                
                // 清空现有选项（保留第一个提示选项）
                while (this.modelSelect.options.length > 1) {
                    this.modelSelect.remove(1);
                }
                
                // 添加机型选项
                Object.keys(this.dataManager.modelData).forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    this.modelSelect.appendChild(option);
                });
                
                // 恢复之前选中的值（如果还存在）
                if (this.dataManager.modelData[currentValue]) {
                    this.modelSelect.value = currentValue;
                }
                
                // 更新固定数据显示
                this.handleModelChange();
            }
            
            // 更新机型列表 - 支持分页
            updateModelList(page = this.currentModelPage) {
                this.currentModelPage = page;
                this.modelList.innerHTML = '';
                
                const models = Object.keys(this.dataManager.modelData);
                const totalPages = Math.ceil(models.length / this.modelsPerPage);
                const startIndex = (page - 1) * this.modelsPerPage;
                const endIndex = Math.min(startIndex + this.modelsPerPage, models.length);
                const pageModels = models.slice(startIndex, endIndex);
                
                if (pageModels.length === 0) {
                    this.modelList.innerHTML = `<div class="no-result">${this.getTranslation('msg.no_models')}</div>`;
                    this.renderPagination(models.length, page, totalPages, 'model');
                    return;
                }
                
                pageModels.forEach(model => {
                    const item = document.createElement('div');
                    item.className = 'model-item fade-in';
                    
                    const modelData = this.dataManager.modelData[model];
                    const btkRule = this.dataManager.btkRules[model] || this.getTranslation('msg.none');
                    
                    item.innerHTML = `
                        <div class="model-item-content">
                            <div class="model-item-row">
                                <span class="model-item-label">${this.getTranslation('label.new_model_id')}：</span>
                                <span class="model-item-value">${model}</span>
                            </div>
                            <div class="model-item-row">
                                <span class="model-item-label">${this.getTranslation('label.btk_rule')}：</span>
                                <span class="model-item-value">${btkRule}</span>
                            </div>
                            <div class="model-item-row">
                                <span class="model-item-label">${this.getTranslation('label.fixed_data')}：</span>
                                <span class="model-item-value">${modelData.data}</span>
                            </div>
                            <div class="date-info">
                                <div class="date-info-item">
                                    <i class="fas fa-calendar-plus"></i>
                                    <span>${this.getTranslation('table.created_date')}: ${this.dateHelper.formatDate(modelData.createdDate, false)}</span>
                                </div>
                                <div class="date-info-item">
                                    <i class="fas fa-calendar-check"></i>
                                    <span>${this.getTranslation('table.modified_date')}: ${this.dateHelper.formatDate(modelData.modifiedDate, false)}</span>
                                </div>
                            </div>
                        </div>
                        <div class="model-item-buttons">
                            <button class="edit-btn" data-model="${model}">${this.getTranslation('btn.edit')}</button>
                            <button class="delete-btn" data-model="${model}">${this.getTranslation('btn.delete')}</button>
                        </div>
                    `;
                    this.modelList.appendChild(item);
                });
                
                // 添加事件监听器
                this.attachModelEvents();
                
                // 渲染分页控件
                this.renderPagination(models.length, page, totalPages, 'model');
            }
            
            // 更新机型板号列表
            updateModelBoardList() {
                this.modelBoardList.innerHTML = '';
                
                Object.keys(this.dataManager.modelBoardMapping).forEach(model => {
                    const item = document.createElement('div');
                    item.className = 'model-item fade-in';
                    const mapping = this.dataManager.modelBoardMapping[model];
                    item.innerHTML = `
                        <div class="model-item-content">
                            <div class="model-item-row">
                                <span class="model-item-label">${this.getTranslation('table.model')}：</span>
                                <span class="model-item-value">${model}</span>
                            </div>
                            <div class="model-item-row">
                                <span class="model-item-label">${this.getTranslation('table.board')}：</span>
                                <span class="model-item-value">${mapping.board}</span>
                            </div>
                            <div class="model-item-row">
                                <span class="model-item-label">${this.getTranslation('label.spec')}：</span>
                                <span class="model-item-value">${mapping.spec || this.getTranslation('msg.none')}</span>
                            </div>
                        </div>
                        <div class="model-item-buttons">
                            <button class="edit-btn" data-model-board="${model}">${this.getTranslation('btn.edit')}</button>
                            <button class="delete-btn" data-model-board="${model}">${this.getTranslation('btn.delete')}</button>
                        </div>
                    `;
                    this.modelBoardList.appendChild(item);
                });
                
                // 添加删除按钮事件
                this.modelBoardList.querySelectorAll('.delete-btn[data-model-board]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const modelToDelete = e.target.getAttribute('data-model-board');
                        if (confirm(this.getTranslation('msg.confirm_delete'))) {
                            this.deleteModelBoard(modelToDelete);
                        }
                    });
                });
                
                // 添加编辑按钮事件
                this.modelBoardList.querySelectorAll('.edit-btn[data-model-board]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const modelToEdit = e.target.getAttribute('data-model-board');
                        this.editModelBoard(modelToEdit);
                    });
                });
            }
            
            // 更新备份列表
            updateBackupList(page = this.currentBackupPage) {
                this.currentBackupPage = page;
                this.backupList.innerHTML = '';
                
                const backups = this.dataManager.getBackupList();
                const totalPages = Math.ceil(backups.length / this.backupsPerPage);
                const startIndex = (page - 1) * this.backupsPerPage;
                const endIndex = Math.min(startIndex + this.backupsPerPage, backups.length);
                const pageBackups = backups.slice(startIndex, endIndex);
                
                if (pageBackups.length === 0) {
                    this.backupList.innerHTML = `<div class="no-result">${this.getTranslation('msg.no_records')}</div>`;
                    this.renderPagination(backups.length, page, totalPages, 'backup');
                    return;
                }
                
                pageBackups.forEach(backup => {
                    const item = document.createElement('div');
                    item.className = 'backup-item fade-in';
                    item.innerHTML = `
                        <div class="backup-info">
                            <div class="backup-name">${backup.name}</div>
                            <div class="backup-meta">
                                <span>${this.getTranslation('backup.date')}: ${this.dateHelper.formatDate(backup.timestamp)}</span>
                                <span> | ${this.getTranslation('backup.size')}: ${this.dateHelper.formatFileSize(backup.size)}</span>
                            </div>
                        </div>
                        <div class="backup-actions">
                            <button class="backup-btn restore" data-backup="${backup.name}">${this.getTranslation('backup.restore')}</button>
                            <button class="backup-btn export" data-backup="${backup.name}">${this.getTranslation('backup.export')}</button>
                            <button class="backup-btn delete" data-backup="${backup.name}">${this.getTranslation('backup.delete')}</button>
                        </div>
                    `;
                    this.backupList.appendChild(item);
                });
                
                // 添加备份操作事件
                this.attachBackupEvents();
                
                // 渲染分页控件
                this.renderPagination(backups.length, page, totalPages, 'backup');
            }
            
            // 更新核对记录表格 - 支持分页
            updateCheckRecordsTable(page = this.currentRecordPage) {
                this.currentRecordPage = page;
                
                const searchTerm = this.searchCheckRecords.value;
                const statusFilter = this.filterCheckStatus.value;
                const dateFilter = this.filterCheckDate.value;
                
                const filteredRecords = this.dataManager.getFilteredCheckRecords(searchTerm, statusFilter, dateFilter);
                const totalPages = Math.ceil(filteredRecords.length / this.recordsPerPage);
                const startIndex = (page - 1) * this.recordsPerPage;
                const endIndex = Math.min(startIndex + this.recordsPerPage, filteredRecords.length);
                const pageRecords = filteredRecords.slice(startIndex, endIndex);
                
                this.checkRecordsBody.innerHTML = '';
                
                if (pageRecords.length === 0) {
                    this.noRecordsMessage.style.display = 'block';
                    this.renderPagination(filteredRecords.length, page, totalPages, 'record');
                    return;
                }
                
                this.noRecordsMessage.style.display = 'none';
                
                pageRecords.forEach(record => {
                    const row = document.createElement('tr');
                    row.className = 'fade-in';
                    
                    const resultClass = record.result === 'ok' ? 'status-ok' : 'status-ng';
                    const resultText = record.result === 'ok' ? 
                        this.getTranslation('option.status_ok') : 
                        this.getTranslation('option.status_ng');
                    
                    row.innerHTML = `
                        <td>${record.model}</td>
                        <td>${record.inputData}</td>
                        <td class="${resultClass}">${resultText}</td>
                        <td>${this.dateHelper.formatDate(record.checkTime)}</td>
                        <td class="actions">
                            <button class="action-btn view" data-record-id="${record.id}" title="${this.getTranslation('btn.view_details')}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn delete" data-record-id="${record.id}" title="${this.getTranslation('btn.delete')}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    this.checkRecordsBody.appendChild(row);
                });
                
                // 添加事件监听器
                this.attachRecordEvents();
                
                // 渲染分页控件
                this.renderPagination(filteredRecords.length, page, totalPages, 'record');
            }
            
            // 渲染分页控件
            renderPagination(totalItems, currentPage, totalPages, type) {
                const paginationContainer = document.getElementById(`${type}-pagination`) || this.createPaginationContainer(type);
                
                let paginationHTML = `
                    <div class="pagination-info">
                        ${this.getTranslation('pagination.showing')} ${Math.min((currentPage - 1) * this.modelsPerPage + 1, totalItems)}-${Math.min(currentPage * this.modelsPerPage, totalItems)} ${this.getTranslation('pagination.of')} ${totalItems} ${this.getTranslation('pagination.items')}
                    </div>
                    <div class="pagination-controls">
                `;
                
                // 上一页按钮
                if (currentPage > 1) {
                    paginationHTML += `<button class="pagination-btn" data-page="${currentPage - 1}" data-type="${type}">
                        <i class="fas fa-chevron-left"></i> ${this.getTranslation('pagination.previous')}
                    </button>`;
                }
                
                // 页码按钮
                const startPage = Math.max(1, currentPage - 2);
                const endPage = Math.min(totalPages, currentPage + 2);
                
                for (let i = startPage; i <= endPage; i++) {
                    paginationHTML += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" data-page="${i}" data-type="${type}">${i}</button>`;
                }
                
                // 下一页按钮
                if (currentPage < totalPages) {
                    paginationHTML += `<button class="pagination-btn" data-page="${currentPage + 1}" data-type="${type}">
                        ${this.getTranslation('pagination.next')} <i class="fas fa-chevron-right"></i>
                    </button>`;
                }
                
                paginationHTML += `</div>`;
                
                paginationContainer.innerHTML = paginationHTML;
                
                // 添加分页事件监听
                this.attachPaginationEvents();
            }
            
            // 创建分页容器
            createPaginationContainer(type) {
                const container = document.createElement('div');
                container.id = `${type}-pagination`;
                container.className = 'pagination-container';
                
                let parentElement;
                if (type === 'model') {
                    parentElement = document.getElementById('model-list').parentElement;
                } else if (type === 'record') {
                    parentElement = document.querySelector('.check-records-container');
                } else if (type === 'backup') {
                    parentElement = document.getElementById('backup-list').parentElement;
                }
                
                if (parentElement) {
                    parentElement.appendChild(container);
                }
                
                return container;
            }
            
            // 附加分页事件
            attachPaginationEvents() {
                document.querySelectorAll('.pagination-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const page = parseInt(e.target.getAttribute('data-page'));
                        const type = e.target.getAttribute('data-type');
                        
                        if (type === 'model') {
                            this.updateModelList(page);
                        } else if (type === 'record') {
                            this.updateCheckRecordsTable(page);
                        } else if (type === 'backup') {
                            this.updateBackupList(page);
                        }
                    });
                });
            }
            
            // 附加机型事件
            attachModelEvents() {
                // 添加删除按钮事件
                this.modelList.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const modelToDelete = e.target.getAttribute('data-model');
                        if (confirm(this.getTranslation('msg.confirm_delete'))) {
                            this.deleteModel(modelToDelete);
                        }
                    });
                });
                
                // 添加编辑按钮事件
                this.modelList.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const modelToEdit = e.target.getAttribute('data-model');
                        this.editModel(modelToEdit);
                    });
                });
            }
            
            // 附加记录事件
            attachRecordEvents() {
                // 添加查看详情按钮事件
                this.checkRecordsBody.querySelectorAll('.action-btn.view').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const recordId = e.target.closest('.action-btn').getAttribute('data-record-id');
                        this.viewRecordDetails(recordId);
                    });
                });
                
                // 添加删除按钮事件
                this.checkRecordsBody.querySelectorAll('.action-btn.delete').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const recordId = e.target.closest('.action-btn').getAttribute('data-record-id');
                        this.deleteCheckRecord(recordId);
                    });
                });
            }
            
            // 附加备份事件
            attachBackupEvents() {
                // 恢复备份
                this.backupList.querySelectorAll('.backup-btn.restore').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const backupName = e.target.getAttribute('data-backup');
                        if (confirm(this.getTranslation('msg.confirm_reset'))) {
                            this.restoreBackup(backupName);
                        }
                    });
                });
                
                // 导出备份
                this.backupList.querySelectorAll('.backup-btn.export').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const backupName = e.target.getAttribute('data-backup');
                        this.exportBackup(backupName);
                    });
                });
                
                // 删除备份
                this.backupList.querySelectorAll('.backup-btn.delete').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const backupName = e.target.getAttribute('data-backup');
                        if (confirm(this.getTranslation('msg.confirm_delete'))) {
                            this.deleteBackup(backupName);
                        }
                    });
                });
            }
            
            // 处理机型选择变化
            handleModelChange() {
                const selectedModel = this.modelSelect.value;
                
                if (selectedModel && this.dataManager.modelData[selectedModel]) {
                    const modelData = this.dataManager.modelData[selectedModel];
                    const fixedData = modelData.data;
                    const btkRule = this.dataManager.btkRules[selectedModel] || this.getTranslation('msg.none');
                    const dynamicFixedData = this.dateHelper.getDynamicFixedData(fixedData);
                    
                    // 更新转换后的固定数据
                    this.fixedDataElement.textContent = dynamicFixedData;
                    const fixedDataLength = fixedData.length;
                    this.fixedDataLengthElement.textContent = fixedDataLength;
                    
                    // 更新BTK编码规则
                    this.btkRuleElement.textContent = btkRule;
                    this.btkRuleLengthElement.textContent = btkRule.length;
                    
                    // 更新原始固定数据
                    this.originalFixedDataElement.textContent = fixedData;
                    this.originalFixedDataLengthElement.textContent = fixedDataLength;
                } else {
                    this.fixedDataElement.textContent = this.getTranslation('msg.select_model_first');
                    this.btkRuleElement.textContent = this.getTranslation('msg.select_model_first');
                    this.originalFixedDataElement.textContent = this.getTranslation('msg.select_model_first');
                    this.fixedDataLengthElement.textContent = '0';
                    this.btkRuleLengthElement.textContent = '0';
                    this.originalFixedDataLengthElement.textContent = '0';
                }
                
                this.clearResult();
            }
            
            // 处理输入变化
            handleInputChange() {
                const inputValue = this.inputData.value;
                this.inputDataLengthElement.textContent = inputValue.length;
                this.inputCountElement.textContent = `${inputValue.length} ${this.getTranslation('unit.characters')}`;
                this.clearResult();
            }
            
            // 清除结果
            clearResult() {
                this.resultElement.textContent = '';
                this.resultElement.className = 'result';
                this.failureDetails.style.display = 'none';
            }
            
            // 核对数据
            checkData() {
                const selectedModel = this.modelSelect.value;
                const inputData = this.inputData.value; // 不再使用trim()，保留空格
                const ignoreDateMarkers = this.ignoreDateMarkersCheckbox.checked;
                
                if (!selectedModel) {
                    this.showNotification(this.getTranslation('msg.select_model'), 'warning');
                    return;
                }
                
                if (!inputData) {
                    this.showNotification(this.getTranslation('msg.input_qr_data'), 'warning');
                    return;
                }
                
                const modelData = this.dataManager.modelData[selectedModel];
                const fixedData = modelData.data;
                const expectedLength = fixedData.length;
                
                // 清空之前的失败详情
                this.failureDetails.style.display = 'none';
                this.failureReasons.innerHTML = '';
                
                if (inputData.length !== expectedLength) {
                    this.dataManager.recordCheck(false);
                    this.updateStatistics();
                    this.showResult('ng', `${this.getTranslation('msg.length_mismatch')}! ${this.getTranslation('msg.expected_length')}: ${expectedLength}, ${this.getTranslation('msg.actual_length')}: ${inputData.length}`);
                    
                    // 显示失败详情
                    this.showFailureDetails([
                        `长度不匹配: 期望长度 ${expectedLength}, 实际长度 ${inputData.length}`
                    ]);
                    
                    // 记录核对结果
                    this.dataManager.addCheckRecord(
                        selectedModel, 
                        inputData, 
                        fixedData, 
                        'ng', 
                        ignoreDateMarkers,
                        [`长度不匹配: 期望长度 ${expectedLength}, 实际长度 ${inputData.length}`]
                    );
                    
                    return;
                }
                
                // 进行模式匹配
                let isMatch;
                let expectedData;
                let failureReasons = [];
                
                if (ignoreDateMarkers) {
                    // 忽略日期标记的模式匹配
                    const matchResult = this.patternMatchIgnoreDateMarkersWithDetails(fixedData, inputData);
                    isMatch = matchResult.isMatch;
                    failureReasons = matchResult.failureReasons;
                    expectedData = fixedData;
                } else {
                    // 标准模式匹配
                    expectedData = this.dateHelper.getDynamicFixedData(fixedData);
                    const matchResult = this.patternMatchWithDetails(expectedData, inputData);
                    isMatch = matchResult.isMatch;
                    failureReasons = matchResult.failureReasons;
                }
                
                // 记录统计
                this.dataManager.recordCheck(isMatch);
                this.updateStatistics();
                
                // 记录核对结果
                this.dataManager.addCheckRecord(
                    selectedModel, 
                    inputData, 
                    expectedData, 
                    isMatch ? 'ok' : 'ng', 
                    ignoreDateMarkers,
                    failureReasons
                );
                
                if (isMatch) {
                    this.showResult('ok', this.getTranslation('msg.match_success'));
                } else {
                    this.showResult('ng', this.getTranslation('msg.match_failed'));
                    // 显示失败详情
                    this.showFailureDetails(failureReasons);
                }
            }
            
            // 模式匹配（支持通配符*，精确匹配包括空格，&匹配1-8）
            patternMatch(pattern, input) {
                if (pattern.length !== input.length) {
                    return false;
                }
                
                for (let i = 0; i < pattern.length; i++) {
                    if (pattern[i] === '&') {
                        // &标记：匹配1-8的数字
                        if (!['1','2','3','4','5','6','7','8'].includes(input[i])) {
                            return false;
                        }
                    } else if (pattern[i] !== '*' && pattern[i] !== input[i]) {
                        return false;
                    }
                }
                
                return true;
            }
            
            // 模式匹配并返回失败详情
            patternMatchWithDetails(pattern, input) {
                const failureReasons = [];
                
                if (pattern.length !== input.length) {
                    failureReasons.push(`长度不匹配: 期望长度 ${pattern.length}, 实际长度 ${input.length}`);
                    return { isMatch: false, failureReasons };
                }
                
                for (let i = 0; i < pattern.length; i++) {
                    if (pattern[i] === '&') {
                        // &标记：匹配1-8的数字
                        if (!['1','2','3','4','5','6','7','8'].includes(input[i])) {
                            failureReasons.push(`位置 ${i+1}: 期望数字1-8, 实际为 '${input[i]}'`);
                        }
                    } else if (pattern[i] !== '*' && pattern[i] !== input[i]) {
                        failureReasons.push(`位置 ${i+1}: 期望字符 '${pattern[i]}', 实际为 '${input[i]}'`);
                    }
                }
                
                return {
                    isMatch: failureReasons.length === 0,
                    failureReasons
                };
            }
            
            // 忽略日期标记的模式匹配
            patternMatchIgnoreDateMarkers(fixedData, input) {
                if (fixedData.length !== input.length) {
                    return false;
                }
                
                const mask = this.dateHelper.createDateMarkerMask(fixedData);
                
                // 进行模式匹配，但忽略日期标记位置
                for (let i = 0; i < fixedData.length; i++) {
                    // 如果是日期标记位置，跳过比较
                    if (mask[i]) {
                        continue;
                    }
                    
                    // 对于非日期标记位置，进行精确比较
                    if (fixedData[i] === '*') {
                        // 通配符匹配任意字符
                        continue;
                    } else if (fixedData[i] === '&') {
                        // &标记：匹配1-8的数字
                        if (!['1','2','3','4','5','6','7','8'].includes(input[i])) {
                            return false;
                        }
                    } else if (fixedData[i] !== input[i]) {
                        return false;
                    }
                }
                
                return true;
            }
            
            // 忽略日期标记的模式匹配并返回失败详情
            patternMatchIgnoreDateMarkersWithDetails(fixedData, input) {
                const failureReasons = [];
                
                if (fixedData.length !== input.length) {
                    failureReasons.push(`长度不匹配: 期望长度 ${fixedData.length}, 实际长度 ${input.length}`);
                    return { isMatch: false, failureReasons };
                }
                
                const mask = this.dateHelper.createDateMarkerMask(fixedData);
                
                // 进行模式匹配，但忽略日期标记位置
                for (let i = 0; i < fixedData.length; i++) {
                    // 如果是日期标记位置，跳过比较
                    if (mask[i]) {
                        continue;
                    }
                    
                    // 对于非日期标记位置，进行精确比较
                    if (fixedData[i] === '*') {
                        // 通配符匹配任意字符
                        continue;
                    } else if (fixedData[i] === '&') {
                        // &标记：匹配1-8的数字
                        if (!['1','2','3','4','5','6','7','8'].includes(input[i])) {
                            failureReasons.push(`位置 ${i+1}: 期望数字1-8, 实际为 '${input[i]}'`);
                        }
                    } else if (fixedData[i] !== input[i]) {
                        failureReasons.push(`位置 ${i+1}: 期望字符 '${fixedData[i]}', 实际为 '${input[i]}'`);
                    }
                }
                
                return {
                    isMatch: failureReasons.length === 0,
                    failureReasons
                };
            }
            
            // 显示结果
            showResult(type, message) {
                this.resultElement.textContent = message;
                this.resultElement.className = `result ${type} fade-in`;
            }
            
            // 显示失败详情
            showFailureDetails(reasons) {
                if (reasons.length === 0) return;
                
                this.failureReasons.innerHTML = '<ul>' + reasons.map(reason => `<li>${reason}</li>`).join('') + '</ul>';
                this.failureDetails.style.display = 'block';
            }
            
            // 查询机型
            queryModel() {
                const qrData = this.qrInput.value; // 不再使用trim()，保留空格
                const ignoreDateMarkers = this.queryIgnoreDateMarkersCheckbox.checked;
                
                if (!qrData) {
                    this.showNotification(this.getTranslation('msg.input_qr_data'), 'warning');
                    return;
                }
                
                let matchedModels = [];
                
                // 遍历所有机型，查找匹配的
                Object.keys(this.dataManager.modelData).forEach(model => {
                    const modelData = this.dataManager.modelData[model];
                    const fixedData = modelData.data;
                    
                    // 检查长度是否匹配
                    const expectedLength = fixedData.length;
                    
                    if (qrData.length === expectedLength) {
                        // 进行模式匹配
                        let isMatch;
                        if (ignoreDateMarkers) {
                            // 忽略日期标记的模式匹配
                            isMatch = this.patternMatchIgnoreDateMarkers(fixedData, qrData);
                        } else {
                            // 标准模式匹配
                            const dynamicFixedData = this.dateHelper.getDynamicFixedData(fixedData);
                            isMatch = this.patternMatch(dynamicFixedData, qrData);
                        }
                        
                        if (isMatch) {
                            matchedModels.push(model);
                        }
                    }
                });
                
                if (matchedModels.length > 0) {
                    this.queryResult.textContent = matchedModels.join(', ');
                } else {
                    this.queryResult.textContent = this.getTranslation('msg.no_matched_models');
                }
            }
            
            // 添加或更新机型
            addOrUpdateModel() {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                // 清除之前的错误信息
                this.clearValidationErrors();
                
                const newModel = this.newModelInput.value.trim();
                const newBtkRule = this.newBtkRuleInput.value.trim();
                const newData = this.newDataInput.value.trim();
                
                if (!newModel) {
                    this.showValidationError('new-model', this.getTranslation('validation.model_required'));
                    return;
                }
                
                if (!newData) {
                    this.showValidationError('new-data', this.getTranslation('validation.fixed_data_required'));
                    return;
                }
                
                const result = this.dataManager.addOrUpdateModel(newModel, newData, newBtkRule, this.editingModel);
                
                if (result.success) {
                    this.updateModelSelect();
                    this.updateModelList();
                    
                    this.newModelInput.value = '';
                    this.newBtkRuleInput.value = '';
                    this.newDataInput.value = '';
                    this.addBtn.textContent = this.getTranslation('btn.add');
                    this.editingModel = null;
                    
                    this.showNotification(result.message, 'success');
                } else {
                    // 显示具体的验证错误
                    if (result.errors && result.errors.length > 0) {
                        result.errors.forEach(error => {
                            if (error.includes('机型编号')) {
                                this.showValidationError('new-model', error);
                            } else if (error.includes('BTK')) {
                                this.showValidationError('new-btk-rule', error);
                            } else if (error.includes('固定数据')) {
                                this.showValidationError('new-data', error);
                            }
                        });
                    } else {
                        this.showNotification(result.message, 'warning');
                    }
                }
            }
            
            // 编辑机型
            editModel(model) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                this.editingModel = model;
                this.newModelInput.value = model;
                this.newBtkRuleInput.value = this.dataManager.btkRules[model] || '';
                this.newDataInput.value = this.dataManager.modelData[model].data;
                this.addBtn.textContent = this.getTranslation('btn.edit');
            }
            
            // 添加或更新机型板号映射
            addOrUpdateModelBoard() {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const newModel = this.newModelBoardInput.value.trim();
                const newBoard = this.newBoardInput.value.trim();
                const newSpec = this.newSpecInput.value.trim();
                
                if (!newModel) {
                    this.showNotification(this.getTranslation('msg.input_model_id'), 'warning');
                    return;
                }
                
                if (!newBoard) {
                    this.showNotification(this.getTranslation('msg.input_board'), 'warning');
                    return;
                }
                
                const result = this.dataManager.addOrUpdateModelBoard(newModel, newBoard, newSpec, this.editingModelBoard);
                
                if (result.success) {
                    this.updateModelBoardList();
                    
                    this.newModelBoardInput.value = '';
                    this.newBoardInput.value = '';
                    this.newSpecInput.value = '';
                    this.addModelBoardBtn.textContent = this.getTranslation('btn.add');
                    this.editingModelBoard = null;
                    
                    this.showNotification(result.message, 'success');
                } else {
                    this.showNotification(result.message, 'warning');
                }
            }
            
            // 编辑机型板号映射
            editModelBoard(model) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                this.editingModelBoard = model;
                const mapping = this.dataManager.modelBoardMapping[model];
                this.newModelBoardInput.value = model;
                this.newBoardInput.value = mapping.board;
                this.newSpecInput.value = mapping.spec || '';
                this.addModelBoardBtn.textContent = this.getTranslation('btn.edit');
            }
            
            // 删除机型
            deleteModel(model) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const result = this.dataManager.deleteModel(model);
                
                if (result.success) {
                    this.updateModelSelect();
                    this.updateModelList();
                    this.showNotification(result.message, 'success');
                } else {
                    this.showNotification(result.message, 'error');
                }
            }
            
            // 删除机型板号映射
            deleteModelBoard(model) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const result = this.dataManager.deleteModelBoard(model);
                
                if (result.success) {
                    this.updateModelBoardList();
                    this.showNotification(result.message, 'success');
                } else {
                    this.showNotification(result.message, 'error');
                }
            }
            
            // 删除核对记录
            deleteCheckRecord(id) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                if (confirm(this.getTranslation('msg.confirm_delete'))) {
                    const result = this.dataManager.deleteCheckRecord(id);
                    
                    if (result.success) {
                        this.updateCheckRecordsTable();
                        this.showNotification(this.getTranslation('msg.record_deleted'), 'success');
                    } else {
                        this.showNotification(result.message, 'error');
                    }
                }
            }
            
            // 清空核对记录
            clearCheckRecords() {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                if (confirm(this.getTranslation('msg.confirm_clear_records'))) {
                    const result = this.dataManager.clearCheckRecords();
                    
                    if (result.success) {
                        this.updateCheckRecordsTable();
                        this.showNotification(this.getTranslation('msg.records_cleared'), 'success');
                    } else {
                        this.showNotification(result.message, 'error');
                    }
                }
            }
            
            // 查看记录详情
            viewRecordDetails(id) {
                const record = this.dataManager.checkRecords.find(r => r.id === id);
                if (!record) return;
                
                const resultClass = record.result === 'ok' ? 'result-ok' : 'result-ng';
                const resultText = record.result === 'ok' ? 
                    this.getTranslation('option.status_ok') : 
                    this.getTranslation('option.status_ng');
                
                // 获取BTK编码规则
                const btkRule = this.dataManager.btkRules[record.model] || this.getTranslation('msg.none');
                
                this.modalBody.innerHTML = `
                    <div class="modal-row">
                        <div class="modal-field">
                            <div class="modal-label">${this.getTranslation('modal.model')}</div>
                            <div class="modal-value">${record.model}</div>
                        </div>
                    </div>
                    <div class="modal-row">
                        <div class="modal-field">
                            <div class="modal-label">${this.getTranslation('modal.input_data')}</div>
                            <div class="modal-value">${record.inputData}</div>
                        </div>
                    </div>
                    <div class="modal-row">
                        <div class="modal-field">
                            <div class="modal-label">${this.getTranslation('label.btk_rule')}</div>
                            <div class="modal-value">${btkRule}</div>
                        </div>
                    </div>
                    <div class="modal-row">
                        <div class="modal-field">
                            <div class="modal-label">${this.getTranslation('modal.expected_data')}</div>
                            <div class="modal-value">${record.expectedData}</div>
                        </div>
                    </div>
                    <div class="modal-row">
                        <div class="modal-field">
                            <div class="modal-label">${this.getTranslation('modal.result')}</div>
                            <div class="modal-value ${resultClass}">${resultText}</div>
                        </div>
                        <div class="modal-field">
                            <div class="modal-label">${this.getTranslation('modal.ignore_date_markers')}</div>
                            <div class="modal-value">${record.ignoreDateMarkers ? '是' : '否'}</div>
                        </div>
                    </div>
                `;
                
                // 如果有失败原因，添加到模态框
                if (record.failureReasons && record.failureReasons.length > 0) {
                    const failureReasonsHTML = record.failureReasons.map(reason => `<li>${reason}</li>`).join('');
                    this.modalBody.innerHTML += `
                        <div class="modal-row">
                            <div class="modal-field">
                                <div class="modal-label">失败原因</div>
                                <div class="modal-value">
                                    <ul>${failureReasonsHTML}</ul>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                this.modalBody.innerHTML += `
                    <div class="modal-row">
                        <div class="modal-field">
                            <div class="modal-label">${this.getTranslation('modal.check_time')}</div>
                            <div class="modal-value">${this.dateHelper.formatDate(record.checkTime)}</div>
                        </div>
                    </div>
                `;
                
                this.openModal();
            }
            
            // 打开模态框
            openModal() {
                this.recordModal.classList.add('active');
            }
            
            // 关闭模态框
            closeModal() {
                this.recordModal.classList.remove('active');
            }
            
            // 清除筛选条件
            clearFilters() {
                this.searchCheckRecords.value = '';
                this.filterCheckStatus.value = '';
                this.filterCheckDate.value = '';
                this.updateCheckRecordsTable();
            }
            
            // 查询机型板号
            queryModelBoard() {
                const query = this.modelBoardInput.value.trim();
                
                if (!query) {
                    this.showNotification(this.getTranslation('msg.input_model_or_board'), 'warning');
                    return;
                }
                
                let results = [];
                
                // 查找匹配的机型或板号
                Object.keys(this.dataManager.modelBoardMapping).forEach(model => {
                    const mapping = this.dataManager.modelBoardMapping[model];
                    const board = mapping.board;
                    const spec = mapping.spec || '';
                    
                    if (model.includes(query) || board.includes(query) || spec.includes(query)) {
                        results.push({ model, board, spec });
                    }
                });
                
                if (results.length > 0) {
                    let resultHTML = '';
                    results.forEach(item => {
                        resultHTML += `
                            <div class="model-board-result-item fade-in">
                                <span><span class="model-board-result-label">${this.getTranslation('table.model')}:</span><span class="model">${item.model}</span></span>
                                <span class="board-right"><span class="model-board-result-label">${this.getTranslation('table.board')}:</span><span class="board">${item.board}</span></span>
                            </div>
                        `;
                    });
                    this.modelBoardResult.innerHTML = resultHTML;
                    
                    // 显示规格信息
                    if (results.length === 1) {
                        this.specDisplay.style.display = 'block';
                        this.specValue.textContent = results[0].spec || this.getTranslation('msg.none');
                    } else {
                        this.specDisplay.style.display = 'none';
                    }
                } else {
                    this.modelBoardResult.innerHTML = `<div class="no-result">${this.getTranslation('msg.no_matched_result')}</div>`;
                    this.specDisplay.style.display = 'none';
                }
            }
            
            // 导出为CSV
            exportToCSV() {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                // 创建CSV内容
                let csvContent = `${this.getTranslation('table.model')},${this.getTranslation('label.btk_rule')},${this.getTranslation('label.fixed_data')},${this.getTranslation('table.created_date')},${this.getTranslation('table.modified_date')}\n`;
                Object.keys(this.dataManager.modelData).forEach(model => {
                    const modelData = this.dataManager.modelData[model];
                    csvContent += `"${model}","${this.dataManager.btkRules[model] || ''}","${modelData.data}","${this.dateHelper.formatDate(modelData.createdDate, false)}","${this.dateHelper.formatDate(modelData.modifiedDate, false)}"\n`;
                });
                
                // 创建Blob并下载
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `${this.getTranslation('panel.model_data_batch')}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification(this.getTranslation('msg.export_success'), 'success');
            }
            
            // 下载模板
            downloadTemplate() {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const templateContent = `${this.getTranslation('table.model')},${this.getTranslation('label.btk_rule')},${this.getTranslation('label.fixed_data')},${this.getTranslation('table.created_date')},${this.getTranslation('table.modified_date')}\n3T01CK231701A,BTK-001,CK2317B~~~~!****,2024-01-01,2024-01-01\n3T02CK231701B,BTK-002,CK2317B~~!!##****,2024-01-01,2024-01-01`;
                
                const blob = new Blob([templateContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `${this.getTranslation('panel.model_data_batch')}_template.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // 从表格导入
            importFromTable(event) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    try {
                        const content = e.target.result;
                        const lines = content.split('\n');
                        let importedCount = 0;
                        let skippedCount = 0;
                        
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (!line) continue;
                            
                            const parts = line.split(',');
                            if (parts.length >= 3) {
                                const model = parts[0].replace(/"/g, '').trim();
                                const btkRule = parts[1].replace(/"/g, '').trim();
                                const data = parts[2].replace(/"/g, '').trim();
                                
                                if (model && data) {
                                    if (!this.dataManager.modelData[model]) {
                                        const now = new Date().toISOString();
                                        this.dataManager.modelData[model] = {
                                            data: data,
                                            createdDate: now,
                                            modifiedDate: now
                                        };
                                        this.dataManager.btkRules[model] = btkRule;
                                        importedCount++;
                                    } else {
                                        skippedCount++;
                                    }
                                }
                            }
                        }
                        
                        this.dataManager.saveModelData();
                        this.dataManager.saveBTKRules();
                        this.updateModelSelect();
                        this.updateModelList();
                        
                        this.showNotification(`${this.getTranslation('msg.import_complete')}! ${this.getTranslation('msg.success_imported')} ${importedCount} ${this.getTranslation('msg.records')}, ${this.getTranslation('msg.skipped')} ${skippedCount} ${this.getTranslation('msg.existing_records')}.`, 'success');
                        
                        // 重置文件输入
                        event.target.value = '';
                    } catch (error) {
                        console.error('从表格导入时发生错误', error);
                        this.showNotification(this.getTranslation('msg.operation_failed'), 'error');
                    }
                };
                
                reader.readAsText(file);
            }
            
            // 导出机型板号为CSV
            exportModelBoardToCSV() {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                // 创建CSV内容
                let csvContent = `${this.getTranslation('table.model')},${this.getTranslation('table.board')},${this.getTranslation('label.spec')}\n`;
                Object.keys(this.dataManager.modelBoardMapping).forEach(model => {
                    const mapping = this.dataManager.modelBoardMapping[model];
                    csvContent += `"${model}","${mapping.board}","${mapping.spec || ''}"\n`;
                });
                
                // 创建Blob并下载
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `${this.getTranslation('panel.model_board_batch')}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification(this.getTranslation('msg.export_success'), 'success');
            }
            
            // 下载机型板号模板
            downloadModelBoardTemplate() {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const templateContent = `${this.getTranslation('table.model')},${this.getTranslation('table.board')},${this.getTranslation('label.spec')}\n3T01CK231701A,CK2317B,标准规格\n3T02CK231701B,CK2317C,高配规格`;
                
                const blob = new Blob([templateContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `${this.getTranslation('panel.model_board_batch')}_template.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // 从表格导入机型板号
            importModelBoardFromTable(event) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    try {
                        const content = e.target.result;
                        const lines = content.split('\n');
                        let importedCount = 0;
                        let skippedCount = 0;
                        
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (!line) continue;
                            
                            const parts = line.split(',');
                            if (parts.length >= 2) {
                                const model = parts[0].replace(/"/g, '').trim();
                                const board = parts[1].replace(/"/g, '').trim();
                                const spec = parts.length >= 3 ? parts[2].replace(/"/g, '').trim() : '';
                                
                                if (model && board) {
                                    if (!this.dataManager.modelBoardMapping[model]) {
                                        this.dataManager.modelBoardMapping[model] = {
                                            board: board,
                                            spec: spec
                                        };
                                        importedCount++;
                                    } else {
                                        skippedCount++;
                                    }
                                }
                            }
                        }
                        
                        this.dataManager.saveModelBoardMapping();
                        this.updateModelBoardList();
                        
                        this.showNotification(`${this.getTranslation('msg.import_complete')}! ${this.getTranslation('msg.success_imported')} ${importedCount} ${this.getTranslation('msg.records')}, ${this.getTranslation('msg.skipped')} ${skippedCount} ${this.getTranslation('msg.existing_records')}.`, 'success');
                        
                        // 重置文件输入
                        event.target.value = '';
                    } catch (error) {
                        console.error('从表格导入机型板号时发生错误', error);
                        this.showNotification(this.getTranslation('msg.operation_failed'), 'error');
                    }
                };
                
                reader.readAsText(file);
            }
            
            // 导出核对记录为CSV
            exportCheckRecordsToCSV() {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                // 创建CSV内容
                let csvContent = `${this.getTranslation('table.model')},${this.getTranslation('table.input_data')},${this.getTranslation('table.expected_data')},${this.getTranslation('table.result')},${this.getTranslation('table.ignore_date_markers')},${this.getTranslation('table.check_time')}\n`;
                this.dataManager.checkRecords.forEach(record => {
                    csvContent += `"${record.model}","${record.inputData}","${record.expectedData}","${record.result}","${record.ignoreDateMarkers}","${this.dateHelper.formatDate(record.checkTime)}"\n`;
                });
                
                // 创建Blob并下载
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `${this.getTranslation('panel.check_records_batch')}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification(this.getTranslation('msg.export_success'), 'success');
            }
            
            // 下载核对记录模板
            downloadCheckRecordsTemplate() {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const templateContent = `${this.getTranslation('table.model')},${this.getTranslation('table.input_data')},${this.getTranslation('table.expected_data')},${this.getTranslation('table.result')},${this.getTranslation('table.ignore_date_markers')},${this.getTranslation('table.check_time')}\n3T01CK231701A,CK2317B20240501ABCD,CK2317B20240501ABCD,ok,false,2024-05-01 10:30:00`;
                
                const blob = new Blob([templateContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `${this.getTranslation('panel.check_records_batch')}_template.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // 从表格导入核对记录
            importCheckRecordsFromTable(event) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    try {
                        const content = e.target.result;
                        const lines = content.split('\n');
                        let importedCount = 0;
                        let skippedCount = 0;
                        
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (!line) continue;
                            
                            const parts = line.split(',');
                            if (parts.length >= 6) {
                                const model = parts[0].replace(/"/g, '').trim();
                                const inputData = parts[1].replace(/"/g, '').trim();
                                const expectedData = parts[2].replace(/"/g, '').trim();
                                const result = parts[3].replace(/"/g, '').trim();
                                const ignoreDateMarkers = parts[4].replace(/"/g, '').trim().toLowerCase() === 'true';
                                const checkTime = parts[5].replace(/"/g, '').trim();
                                
                                if (model && inputData && expectedData && result && checkTime) {
                                    const record = {
                                        id: Date.now().toString() + i,
                                        model: model,
                                        inputData: inputData,
                                        expectedData: expectedData,
                                        result: result,
                                        ignoreDateMarkers: ignoreDateMarkers,
                                        checkTime: checkTime
                                    };
                                    
                                    this.dataManager.checkRecords.unshift(record);
                                    importedCount++;
                                }
                            }
                        }
                        
                        // 限制记录数量，保留最近1000条
                        if (this.dataManager.checkRecords.length > 1000) {
                            this.dataManager.checkRecords = this.dataManager.checkRecords.slice(0, 1000);
                        }
                        
                        this.dataManager.saveCheckRecords();
                        this.updateCheckRecordsTable();
                        
                        this.showNotification(`${this.getTranslation('msg.import_complete')}! ${this.getTranslation('msg.success_imported')} ${importedCount} ${this.getTranslation('msg.records')}.`, 'success');
                        
                        // 重置文件输入
                        event.target.value = '';
                    } catch (error) {
                        console.error('从表格导入核对记录时发生错误', error);
                        this.showNotification(this.getTranslation('msg.operation_failed'), 'error');
                    }
                };
                
                reader.readAsText(file);
            }
            
            // 创建备份
            createBackup() {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const backupName = this.backupNameInput.value.trim();
                const result = this.dataManager.backupData(backupName);
                
                if (result.success) {
                    this.updateBackupList();
                    this.backupNameInput.value = '';
                    this.showNotification(result.message, 'success');
                } else {
                    this.showNotification(result.message, 'error');
                }
            }
            
            // 恢复备份
            restoreBackup(backupName) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const result = this.dataManager.restoreData(backupName);
                
                if (result.success) {
                    this.updateUI();
                    this.showNotification(result.message, 'success');
                } else {
                    this.showNotification(result.message, 'error');
                }
            }
            
            // 导出备份
            exportBackup(backupName) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const result = this.dataManager.exportBackup(backupName);
                
                if (result.success) {
                    this.showNotification(result.message, 'success');
                } else {
                    this.showNotification(result.message, 'error');
                }
            }
            
            // 删除备份
            deleteBackup(backupName) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const result = this.dataManager.deleteBackup(backupName);
                
                if (result.success) {
                    this.updateBackupList();
                    this.showNotification(result.message, 'success');
                } else {
                    this.showNotification(result.message, 'error');
                }
            }
            
            // 导入备份
            importBackup(event) {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                const file = event.target.files[0];
                if (!file) return;
                
                this.showLoading(true);
                
                this.dataManager.importBackup(file).then(result => {
                    this.showLoading(false);
                    
                    if (result.success) {
                        this.updateBackupList();
                        this.showNotification(result.message, 'success');
                    } else {
                        this.showNotification(result.message, 'error');
                    }
                    
                    // 重置文件输入
                    event.target.value = '';
                });
            }
            
            // 重置数据
            resetData() {
                // 检查权限
                if (this.userManager.getCurrentUser().role !== 'admin') {
                    this.showNotification(this.getTranslation('msg.need_admin_permission'), 'warning');
                    return;
                }
                
                if (confirm(this.getTranslation('msg.confirm_reset'))) {
                    const result = this.dataManager.clearAllData();
                    
                    if (result.success) {
                        this.updateModelSelect();
                        this.updateModelList();
                        this.updateModelBoardList();
                        this.updateCheckRecordsTable();
                        
                        // 清空查询结果
                        this.queryResult.textContent = this.getTranslation('msg.no_matched_models');
                        this.modelBoardResult.innerHTML = `<div class="no-result">${this.getTranslation('msg.input_model_or_board')}</div>`;
                        
                        this.showNotification(result.message, 'success');
                    } else {
                        this.showNotification(result.message, 'error');
                    }
                }
            }
            
            // 切换语言
            changeLanguage(lang) {
                this.currentLanguage = lang;
                localStorage.setItem('language', lang);
                this.languageSelector.value = lang;
                this.dataManager.setLanguage(lang);
                
                // 更新所有文本
                this.updateAllTexts();
                
                this.showNotification(`${this.getTranslation('msg.language_changed')}: ${this.getLanguageName(lang)}`, 'info');
            }
            
            // 更新所有文本
            updateAllTexts() {
                // 更新应用标题
                document.getElementById('app-title').textContent = this.getTranslation('app_title');
                
                // 更新所有带有data-translate属性的元素
                document.querySelectorAll('[data-translate]').forEach(element => {
                    const key = element.getAttribute('data-translate');
                    element.textContent = this.getTranslation(key);
                });
                
                // 更新所有带有data-translate-placeholder属性的元素
                document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                    const key = element.getAttribute('data-translate-placeholder');
                    element.placeholder = this.getTranslation(key);
                });
                
                // 更新按钮文本
                this.addBtn.textContent = this.getTranslation('btn.add');
                this.addModelBoardBtn.textContent = this.getTranslation('btn.add');
                
                // 更新模型列表
                this.updateModelList();
                this.updateModelBoardList();
                
                // 更新核对记录表格
                this.updateCheckRecordsTable();
                
                // 更新备份列表
                this.updateBackupList();
            }
            
            // 获取翻译文本
            getTranslation(key) {
                return translations[this.currentLanguage]?.[key] || key;
            }
            
            // 获取语言名称
            getLanguageName(lang) {
                const names = {
                    'zh-CN': '中文',
                    'en': 'English',
                    'vi': 'Tiếng Việt'
                };
                return names[lang] || lang;
            }
            
            // 清空输入
            clearInput() {
                this.inputData.value = '';
                this.handleInputChange();
                this.showNotification(this.getTranslation('msg.input_cleared'), 'info');
            }
            
            // 批量核对
            batchCheck() {
                const inputText = this.batchInput.value;
                if (!inputText) {
                    this.showNotification(this.getTranslation('msg.input_batch_data'), 'warning');
                    return;
                }
                
                const lines = inputText.split('\n').filter(line => line.length > 0); // 只过滤掉空行，保留包含空格的行
                if (lines.length === 0) {
                    this.showNotification(this.getTranslation('msg.no_valid_data'), 'warning');
                    return;
                }
                
                this.batchResult.innerHTML = '';
                
                lines.forEach((line, index) => {
                    const result = this.checkBatchLine(line); // 不再使用trim()，保留空格
                    const item = document.createElement('div');
                    item.className = `batch-item ${result.status}`;
                    item.innerHTML = `
                        <span>${index + 1}. ${line}</span>
                        <span>${result.message}</span>
                    `;
                    this.batchResult.appendChild(item);
                });
                
                this.showNotification(`${this.getTranslation('msg.batch_check_completed')}: ${lines.length} ${this.getTranslation('msg.data_records')}`, 'success');
            }
            
            // 检查批量数据行
            checkBatchLine(line) {
                const selectedModel = this.modelSelect.value;
                if (!selectedModel) {
                    return { status: 'ng', message: this.getTranslation('msg.no_model_selected') };
                }
                
                const modelData = this.dataManager.modelData[selectedModel];
                const fixedData = modelData.data;
                const expectedLength = fixedData.length;
                
                if (line.length !== expectedLength) {
                    return { status: 'ng', message: `${this.getTranslation('msg.length_mismatch')}: ${expectedLength}` };
                }
                
                const ignoreDateMarkers = this.ignoreDateMarkersCheckbox.checked;
                let expectedData;
                let isMatch;
                let failureReasons = [];
                
                if (ignoreDateMarkers) {
                    // 忽略日期标记的模式匹配
                    const matchResult = this.patternMatchIgnoreDateMarkersWithDetails(fixedData, line);
                    isMatch = matchResult.isMatch;
                    failureReasons = matchResult.failureReasons;
                    expectedData = fixedData;
                } else {
                    // 标准模式匹配
                    expectedData = this.dateHelper.getDynamicFixedData(fixedData);
                    const matchResult = this.patternMatchWithDetails(expectedData, line);
                    isMatch = matchResult.isMatch;
                    failureReasons = matchResult.failureReasons;
                }
                
                // 记录核对结果
                this.dataManager.addCheckRecord(
                    selectedModel, 
                    line, 
                    expectedData, 
                    isMatch ? 'ok' : 'ng', 
                    ignoreDateMarkers,
                    failureReasons
                );
                
                return {
                    status: isMatch ? 'ok' : 'ng',
                    message: isMatch ? this.getTranslation('msg.match_success') : this.getTranslation('msg.match_failed')
                };
            }
            
            // 更新统计信息显示
            updateStatistics() {
                const stats = this.dataManager.getStatistics();
                const dataStats = this.dataManager.getDataStats();
                
                this.totalModelsElement.textContent = dataStats.modelCount;
                this.todayChecksElement.textContent = stats.today.checks;
                this.successRateElement.textContent = `${stats.overall.successRate}%`;
            }
            
            // 显示验证错误
            showValidationError(field, message) {
                const errorElement = document.getElementById(`${field}-error`);
                if (errorElement) {
                    errorElement.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
                    errorElement.style.display = 'block';
                    
                    // 添加错误样式到输入框
                    const inputElement = document.getElementById(field);
                    if (inputElement) {
                        inputElement.classList.add('input-error');
                    }
                }
            }
            
            // 清除验证错误
            clearValidationErrors() {
                // 清除错误消息
                document.querySelectorAll('.validation-error').forEach(element => {
                    element.innerHTML = '';
                    element.style.display = 'none';
                });
                
                // 清除输入框错误样式
                document.querySelectorAll('.input-error').forEach(element => {
                    element.classList.remove('input-error');
                });
            }
            
            // 防抖搜索设置
            setupDebouncedSearch() {
                this.searchCheckRecords.addEventListener('input', this.debounce(() => {
                    this.updateCheckRecordsTable(1);
                }, 300));
                
                this.filterCheckStatus.addEventListener('change', this.debounce(() => {
                    this.updateCheckRecordsTable(1);
                }, 300));
                
                this.filterCheckDate.addEventListener('change', this.debounce(() => {
                    this.updateCheckRecordsTable(1);
                }, 300));
            }
            
            // 防抖函数
            debounce(func, wait) {
                return (...args) => {
                    clearTimeout(this.debounceTimers[func]);
                    this.debounceTimers[func] = setTimeout(() => func.apply(this, args), wait);
                };
            }
            
            // 显示加载状态
            showLoading(show) {
                if (show) {
                    this.loadingOverlay.classList.add('active');
                } else {
                    this.loadingOverlay.classList.remove('active');
                }
            }
            
            // 显示通知消息
            showNotification(message, type = 'info') {
                this.notification.textContent = message;
                this.notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    this.notification.classList.remove('show');
                }, 3000);
            }
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            window.qrTool = new QRDataCheckTool();
        });
    </script>
</body>
</html>